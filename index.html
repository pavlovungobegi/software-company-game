<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Software Company Simulator</title>
  <style>
    /* ============================================ */
    /* SOFTWARE COMPANY SIMULATOR - STYLES */
    /* Version 2.0 | Phase 1-2: Core + Products */
    /* ============================================ */
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f9fafb;
      color: #111827;
      line-height: 1.6;
      padding-top: 130px;
    }
    
    /* Header Wrapper - Fixed Container */
    .header-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    /* Header */
    .header {
      background: #2563eb;
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-controls {
      background: #1e40af;
      color: white;
      padding: 0.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    
    .company-name {
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .day-counter {
      font-size: 1.2rem;
      font-family: 'Courier New', monospace;
    }
    
    .day-counter small {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    
    .cash-display {
      font-size: 1.5rem;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      background: rgba(255,255,255,0.2);
    }
    
    .cash-display.green { background: #10b981; }
    .cash-display.yellow { background: #f59e0b; }
    .cash-display.red { background: #ef4444; }
    .cash-display.flashing-red { 
      background: #ef4444;
      animation: flash 0.5s infinite;
    }
    
    @keyframes flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    .founder-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      font-size: 0.9rem;
      cursor: help;
    }
    
    .speed-controls {
      display: flex;
      gap: 0.5rem;
    }
    
    .speed-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    
    .speed-btn:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .speed-btn.active {
      background: rgba(255,255,255,0.4);
      font-weight: bold;
    }
    
    .game-controls {
      display: flex;
      gap: 0.5rem;
    }
    
    .game-ctrl-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .game-ctrl-btn:hover {
      background: rgba(255,255,255,0.35);
      transform: translateY(-1px);
    }
    
    .game-ctrl-btn:active {
      transform: translateY(0);
    }
    
    .reset-btn {
      background: rgba(239, 68, 68, 0.3);
    }
    
    .reset-btn:hover {
      background: rgba(239, 68, 68, 0.5);
    }
    
    /* Main Layout */
    .main-container {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
      padding: 1rem;
      max-width: 1800px;
      margin: 0 auto;
    }
    
    /* Mobile Navigation */
    .mobile-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e5e7eb;
      z-index: 999;
      padding: 0.5rem;
    }
    
    .mobile-nav-buttons {
      display: flex;
      justify-content: space-around;
      gap: 0.5rem;
    }
    
    .mobile-nav-btn {
      flex: 1;
      padding: 0.6rem 0.5rem;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      min-width: 0;
    }
    
    .mobile-nav-btn.active {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }
    
    /* Mobile Styles */
    @media (max-width: 1024px) {
      body {
        padding-top: 70px;
        padding-bottom: 70px;
      }
      
      /* Much smaller header on mobile */
      .header {
        padding: 0.35rem 0.75rem;
      }
      
      .header-left {
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      
      .company-name {
        font-size: 0.85rem;
      }
      
      .day-counter {
        font-size: 0.75rem;
      }
      
      .day-counter small {
        font-size: 0.6rem;
        display: block;
      }
      
      .founder-badge {
        font-size: 0.65rem;
        padding: 0.15rem 0.4rem;
      }
      
      .cash-display {
        font-size: 0.9rem;
        padding: 0.3rem 0.6rem;
      }
      
      .header-controls {
        padding: 0.3rem 0.75rem;
      }
      
      .speed-btn {
        padding: 0.3rem 0.5rem;
        font-size: 0.7rem;
      }
      
      .game-ctrl-btn {
        padding: 0.3rem 0.6rem;
        font-size: 0.75rem;
      }
      
      /* Swipeable panels */
      .main-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        gap: 0;
        padding: 0;
        margin: 0;
        width: 100vw;
        scrollbar-width: none;
      }
      
      .main-container::-webkit-scrollbar {
        display: none;
      }
      
      .panel {
        min-width: 100vw;
        scroll-snap-align: start;
        border-radius: 0;
        margin-top: 5vh;
        height: calc(100vh - 70px - 70px);
        overflow-y: auto;
        padding: 1.5rem 1rem 1rem 1rem;
      }
      
      /* Hide desktop event log on mobile (it becomes its own panel) */
      body > div > .event-log {
        display: none;
      }
      
      /* Show event log panel on mobile */
      #eventLogPanel {
        display: flex;
      }
      
      /* Show mobile navigation */
      .mobile-nav {
        display: block;
      }
      
      /* Hide some controls on very small screens */
      @media (max-width: 640px) {
        .header-left {
          font-size: 0.85rem;
        }
        
        .speed-btn span {
          display: none;
        }
      }
    }
    
    /* Hide mobile event log panel on desktop */
    @media (min-width: 1025px) {
      #eventLogPanel {
        display: none;
      }
    }
    
    /* Panels */
    .panel {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .panel-header {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
      padding-bottom: 0.4rem;
      border-bottom: 2px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Buttons */
    .btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.5rem 0.85rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background 0.2s;
    }
    
    .btn:hover {
      background: #1d4ed8;
    }
    
    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    
    .btn-success {
      background: #10b981;
    }
    
    .btn-success:hover {
      background: #059669;
    }
    
    .btn-danger {
      background: #ef4444;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    
    .btn-sm {
      padding: 0.35rem 0.75rem;
      font-size: 0.85rem;
    }
    
    /* Pause Banner */
    .pause-banner {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.4);
      color: white;
      padding: 1rem 2.5rem;
      border-radius: 8px;
      font-size: 1.2rem;
      font-weight: bold;
      display: none;
      z-index: 9999;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(8px);
      animation: slideDown 0.3s ease-out;
    }
    
    .pause-banner.active {
      display: block;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
    
    /* Event Log */
    .event-log {
      background: white;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      height: 120px;
      overflow-y: auto;
    }
    
    .event-log h3 {
      font-size: 0.9rem;
      margin-bottom: 0.4rem;
      color: #6b7280;
    }
    
    .event {
      padding: 0.2rem 0;
      font-size: 0.8rem;
      color: #374151;
      line-height: 1.3;
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 100vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
      text-align: center;
      color: #2563eb;
    }
    
    .modal-body {
      margin-bottom: 1.5rem;
    }
    
    .modal-footer {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #374151;
    }
    
    .form-group input[type="text"] {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .form-group input[type="text"]:focus {
      outline: none;
      border-color: #2563eb;
    }
    
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .radio-option {
      display: flex;
      align-items: center;
      padding: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .radio-option:hover {
      border-color: #2563eb;
      background: #eff6ff;
    }
    
    .radio-option input[type="radio"] {
      margin-right: 0.75rem;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .radio-option-content {
      flex: 1;
    }
    
    .radio-option-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .radio-option-desc {
      font-size: 0.85rem;
      color: #6b7280;
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 1rem;
      color: #9ca3af;
      font-size: 0.85rem;
    }
    
    /* Loading state */
    .loading {
      text-align: center;
      padding: 2rem;
      color: #6b7280;
    }
    
    /* ============================================ */
    /* PHASE 2: PRODUCT SYSTEM STYLES */
    /* ============================================ */
    
    /* Product Cards */
    .product-card {
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }
    
    .product-card.in-development {
      border-color: #9ca3af;
      background: #fffbeb;
    }
    
    .product-card.published {
      border-color: #10b981;
      background: #f0fdf4;
    }
    
    .product-card.deprecated {
      border-color: #ef4444;
      background: #fef2f2;
      opacity: 0.7;
    }
    
    .product-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }
    
    .product-name {
      font-weight: bold;
      font-size: 0.95rem;
      color: #111827;
    }
    
    .product-status {
      padding: 0.2rem 0.6rem;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .status-dev {
      background: #fef3c7;
      color: #92400e;
    }
    
    .status-published {
      background: #d1fae5;
      color: #065f46;
    }
    
    .status-deprecated {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .product-info {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 0.4rem;
      line-height: 1.3;
    }
    
    .product-info strong {
      color: #374151;
    }
    
    .progress-bar {
      width: 100%;
      height: 20px;
      background: #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
      margin: 0.5rem 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2563eb, #3b82f6);
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .lifetime-indicator {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }
    
    .lifetime-green {
      background: #d1fae5;
      color: #065f46;
    }
    
    .lifetime-yellow {
      background: #fef3c7;
      color: #92400e;
    }
    
    .lifetime-orange {
      background: #fed7aa;
      color: #9a3412;
    }
    
    .lifetime-red {
      background: #fee2e2;
      color: #991b1b;
    }
    
    /* Product Template Selection */
    .product-template {
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .product-template:hover {
      border-color: #93c5fd;
      background: #f0f9ff;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.15);
    }
    
    .product-template input[type="radio"] {
      margin-top: 0.25rem;
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #2563eb;
      flex-shrink: 0;
    }
    
    .product-template:has(input[type="radio"]:checked) {
      border-color: #2563eb;
      background: #eff6ff;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .product-template:has(input[type="radio"]:checked) .template-name {
      color: #2563eb;
    }
    
    .product-template.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f3f4f6;
      border-color: #d1d5db;
    }
    
    .product-template.disabled:hover {
      border-color: #d1d5db;
      background: #f3f4f6;
      box-shadow: none;
    }
    
    .product-template.disabled input[type="radio"] {
      cursor: not-allowed;
    }
    
    .template-content {
      flex: 1;
    }
    
    .template-name {
      font-weight: bold;
      font-size: 1.05rem;
      color: #111827;
      margin-bottom: 0.5rem;
    }
    
    .template-details {
      font-size: 0.875rem;
      color: #6b7280;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.4rem;
      margin-bottom: 0.5rem;
    }
    
    .template-detail {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    
    .template-description {
      font-size: 0.8rem;
      color: #9ca3af;
      font-style: italic;
      margin-top: 0.25rem;
    }
    
    .scrollable-list {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }
    
    .scrollable-list::-webkit-scrollbar {
      width: 8px;
    }
    
    .scrollable-list::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    
    .scrollable-list::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    
    .scrollable-list::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    .modal-intro {
      color: #6b7280;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: #f9fafb;
      border-radius: 6px;
      border-left: 3px solid #2563eb;
    }
    
    /* ============================================ */
    /* EMPLOYEE SYSTEM - Phase 3 */
    /* ============================================ */
    
    /* Employee Cards */
    .employee-card {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.6rem;
      transition: all 0.2s;
    }
    
    .employee-card:hover {
      border-color: #2563eb;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
    }
    
    /* Assigned Person Cards (in product assignment sections) */
    .assigned-person-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.85rem;
    }
    
    .assigned-person-name {
      color: #374151;
      font-weight: 500;
    }
    
    .person-role {
      color: #6b7280;
      font-weight: 400;
      font-size: 0.8rem;
    }
    
    .unassign-btn {
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: bold;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    
    .unassign-btn:hover {
      background: #dc2626;
      transform: scale(1.1);
    }
    
    .add-person-btn {
      background: white;
      color: #2563eb;
      border: 2px dashed #93c5fd;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    
    .add-person-btn:hover {
      background: #eff6ff;
      border-color: #2563eb;
      transform: translateY(-1px);
    }
    
    .employee-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    
    .employee-name {
      font-weight: bold;
      font-size: 1rem;
      color: #111827;
    }
    
    .employee-role {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-top: 0.25rem;
    }
    
    .role-developer {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .role-marketer {
      background: #fce7f3;
      color: #be185d;
    }
    
    .employee-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 0.75rem;
    }
    
    .employee-stat {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    
    .skill-badge {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .skill-junior { background: #fef3c7; color: #92400e; }
    .skill-intermediate { background: #dbeafe; color: #1e40af; }
    .skill-senior { background: #d1fae5; color: #065f46; }
    .skill-lead { background: #e9d5ff; color: #6b21a8; }
    .skill-expert { background: #fecaca; color: #991b1b; }
    
    .employee-assignment {
      font-size: 0.8rem;
      color: #9ca3af;
      padding: 0.5rem;
      background: #f9fafb;
      border-radius: 6px;
      margin-bottom: 0.5rem;
    }
    
    .assignment-active {
      color: #2563eb;
      background: #eff6ff;
      font-weight: 500;
    }
    
    .hire-section {
      background: #f9fafb;
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .hire-section h3 {
      margin: 0 0 0.75rem 0;
      color: #374151;
      font-size: 1rem;
    }
    
    .hire-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .hire-btn {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .hire-btn:hover:not(:disabled) {
      border-color: #2563eb;
      background: #eff6ff;
      transform: translateY(-1px);
    }
    
    .hire-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .hire-btn-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .hire-btn-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: #111827;
    }
    
    .hire-btn-stats {
      font-size: 0.8rem;
      color: #6b7280;
    }
    
    .hire-btn-cost {
      font-weight: bold;
      font-size: 0.95rem;
      color: #059669;
    }
    
    /* Office Info */
    .office-info {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }
    
    .office-name {
      font-weight: bold;
      font-size: 0.95rem;
      margin-bottom: 0.4rem;
      color: #111827;
    }
    
    .office-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
      color: #6b7280;
    }
    
    .office-upgrade-section {
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid #e5e7eb;
    }
    
    .office-upgrade-btn {
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: #2563eb;
      border: none;
      border-radius: 6px;
      color: white;
      font-weight: 600;
      font-size: 0.8rem;
      line-height: 1.3;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.75rem;
      min-height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .office-upgrade-btn:hover:not(:disabled) {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .office-upgrade-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #9ca3af;
    }
    
    .office-upgrade-details {
      background: #f9fafb;
      border-radius: 6px;
      padding: 0.5rem;
      font-size: 0.75rem;
      min-height: 5rem;
    }
    
    .upgrade-detail {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.15rem 0;
      color: #6b7280;
      font-size: 0.7rem;
      line-height: 1.4;
    }
    
    .upgrade-detail span:last-child {
      text-align: right;
    }
    
    .upgrade-detail strong {
      color: #111827;
      font-weight: 600;
    }
    
    /* ============================================ */
    /* FINANCES PANEL */
    /* ============================================ */
    
    .finance-card {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.75rem;
      transition: all 0.2s;
    }
    
    .finance-header {
      font-size: 0.9rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.5rem;
      padding-bottom: 0.35rem;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .finance-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.3rem 0;
      font-size: 0.85rem;
    }
    
    .finance-row-sub {
      font-size: 0.75rem;
      color: #6b7280;
      padding-left: 0.5rem;
      margin-top: -0.15rem;
      line-height: 1.3;
    }
    
    .finance-value {
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .finance-value.positive {
      color: #10b981;
    }
    
    .finance-value.negative {
      color: #ef4444;
    }
    
    .finance-value.neutral {
      color: #6b7280;
    }
    
    .finance-divider {
      height: 1px;
      background: #e5e7eb;
      margin: 0.5rem 0;
    }
    
    /* Server Capacity */
    .server-capacity {
      margin-top: 0.5rem;
    }
    
    .capacity-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.35rem;
    }
    
    .capacity-bar {
      height: 16px;
      background: #f3f4f6;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }
    
    .capacity-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      transition: all 0.3s;
      border-radius: 8px;
    }
    
    .capacity-fill.capacity-warning {
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
    }
    
    .capacity-fill.capacity-critical {
      background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
    }
    
    .capacity-percent {
      text-align: center;
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.2rem;
      font-weight: 600;
    }
    
    /* Founder XP Tooltip */
    .founder-badge {
      position: relative;
    }
    
    .founder-xp-tooltip {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      white-space: nowrap;
      margin-top: 0.5rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 1000;
    }
    
    .founder-badge:hover .founder-xp-tooltip {
      opacity: 1;
    }
    
    .xp-progress-bar {
      width: 150px;
      height: 6px;
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 0.25rem;
    }
    
    .xp-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #34d399);
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <!-- Header Wrapper - Contains both header bars -->
  <div class="header-wrapper">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <div class="company-name" id="companyNameDisplay">My Startup</div>
        <div class="day-counter">
          Day <span id="dayCounter">0</span>
          <small>(<span id="yearMonth">Year 0, Month 0</span>)</small>
        </div>
        <div class="founder-badge">
          <span>üë®‚Äçüíº Lvl <span id="founderLevel">1</span> (<span id="founderXP">0</span> XP)</span>
          <div class="founder-xp-tooltip">
            <div><strong id="founderName">Founder</strong></div>
            <div>Level <span id="tooltipLevel">1</span> - <span id="tooltipEfficiency">100</span>% Efficiency</div>
            <div>XP: <span id="tooltipCurrentXP">0</span> / <span id="tooltipNextLevelXP">100</span></div>
            <div class="xp-progress-bar">
              <div class="xp-progress-fill" id="xpProgressBar" style="width: 0%"></div>
            </div>
            <div style="font-size: 0.75rem; margin-top: 0.25rem; color: #d1d5db;">
              <span id="tooltipXPNeeded">100</span> XP to next level
            </div>
            <div style="font-size: 0.8rem; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #374151;">
              <span id="tooltipCurrentAssignment">Not assigned</span>
            </div>
          </div>
        </div>
      </div>
      <div class="header-right">
        <div class="cash-display green" id="cashDisplay">$0</div>
      </div>
    </div>

    <!-- Speed Controls -->
    <div class="header-controls">
    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
      <div class="speed-controls">
        <button class="speed-btn" id="pauseBtn" title="Pause game">‚è∏ Pause<span style="font-size: 0.7rem; opacity: 0.7;">(Space)</span></button>
        <button class="speed-btn active" id="playBtn" title="Play game">‚ñ∂ Play (1x)<span style="font-size: 0.7rem; opacity: 0.7;">(Space)</span></button>
        <button class="speed-btn" id="speed2xBtn" title="Play at 2x speed">2x</button>
        <button class="speed-btn" id="speed5xBtn" title="Play at 5x speed">5x</button>
      </div>
      <div class="game-controls">
        <button class="game-ctrl-btn" id="saveBtn" title="Save game to browser storage">Save</button>
        <button class="game-ctrl-btn reset-btn" id="resetBtn" title="Reset and start a new game">Reset</button>
      </div>
    </div>
  </div>
  </div><!-- End Header Wrapper -->

  <!-- Pause Banner -->
  <div class="pause-banner" id="pauseBanner">
    ‚è∏Ô∏è PAUSED
  </div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Products Panel -->
    <div class="panel">
      <div class="panel-header">
        <span>Products</span>
        <button class="btn btn-success" id="newProductBtn">+ New Product</button>
      </div>
      <div id="productsContainer">
        <div class="empty-state">No products yet. Start building!</div>
      </div>
    </div>

    <!-- Employees Panel -->
    <div class="panel">
      <div class="panel-header">
        <span>üë• Team</span>
      </div>
      <div id="employeesContainer">
        <!-- Office Info -->
        <div class="office-info" id="officeInfo"></div>
        
        <!-- Hire Buttons -->
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button class="btn" onclick="showHireDeveloperModal()" style="flex: 1;">
            üë®‚Äçüíª Hire Developer
          </button>
          <button class="btn" onclick="showHireMarketerModal()" style="flex: 1;">
            üì¢ Hire Marketer
          </button>
        </div>
        
        <!-- Employee List -->
        <div id="employeeList"></div>
      </div>
    </div>

    <!-- Finances Panel -->
    <div class="panel">
      <div class="panel-header">
        <span>Finances</span>
      </div>
      <div class="panel-content" id="financesContent">
        <div class="loading">Loading financial data...</div>
      </div>
    </div>

    <!-- Event Log Panel (Mobile Only) -->
    <div class="panel" id="eventLogPanel">
      <div class="panel-header">
        <span>üìã Event Log</span>
      </div>
      <div id="eventLogMobile" style="font-size: 0.9rem;"></div>
    </div>
  </div>

  <!-- Mobile Navigation (Bottom Tab Bar) -->
  <div class="mobile-nav">
    <div class="mobile-nav-buttons">
      <button class="mobile-nav-btn active" onclick="scrollToPanel(0)">
        üì¶
      </button>
      <button class="mobile-nav-btn" onclick="scrollToPanel(1)">
        üë•
      </button>
      <button class="mobile-nav-btn" onclick="scrollToPanel(2)">
        üí∞
      </button>
      <button class="mobile-nav-btn" onclick="scrollToPanel(3)">
        üìã
      </button>
    </div>
  </div>

  <!-- Event Log -->
  <div style="max-width: 1800px; margin: 0 auto; padding: 0 1.5rem 1.5rem;">
    <div class="event-log">
      <div id="eventLog"></div>
    </div>
  </div>

  <!-- New Product Modal -->
  <div class="modal-overlay" id="newProductModal">
    <div class="modal">
      <div class="modal-header">üî® Create New Product</div>
      <div class="modal-body">
        <div class="modal-intro">Select a product template to begin development. Each product has different development time, lifetime, pricing, and server costs.</div>
        <div class="scrollable-list" id="productTemplatesList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="cancelProductBtn">Cancel</button>
        <button class="btn btn-success" id="createProductBtn">Start Building üî®</button>
      </div>
    </div>
  </div>

  <!-- Hire Developer Modal -->
  <div class="modal-overlay" id="hireDeveloperModal">
    <div class="modal">
      <div class="modal-header">üë®‚Äçüíª Hire Developer</div>
      <div class="modal-body">
        <div class="modal-intro">Select a developer skill tier to hire. Higher skilled developers work faster but cost more.</div>
        <div class="scrollable-list" id="hireDeveloperList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="hideHireDeveloperModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Hire Marketer Modal -->
  <div class="modal-overlay" id="hireMarketerModal">
    <div class="modal">
      <div class="modal-header">üì¢ Hire Marketer</div>
      <div class="modal-body">
        <div class="modal-intro">Select a marketer skill tier to hire. Higher skilled marketers attract more customers but cost more.</div>
        <div class="scrollable-list" id="hireMarketerList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="hideHireMarketerModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Assign Developer to Product Modal -->
  <div class="modal-overlay" id="assignDeveloperModal">
    <div class="modal">
      <div class="modal-header">üë®‚Äçüíª Assign Developer</div>
      <div class="modal-body">
        <div class="modal-intro" id="assignDeveloperProductName"></div>
        <div class="scrollable-list" id="assignDeveloperList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="hideAssignDeveloperModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Assign Marketer to Product Modal -->
  <div class="modal-overlay" id="assignMarketerModal">
    <div class="modal">
      <div class="modal-header">üì¢ Assign Marketer</div>
      <div class="modal-body">
        <div class="modal-intro" id="assignMarketerProductName"></div>
        <div class="scrollable-list" id="assignMarketerList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="hideAssignMarketerModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Game Over Modal -->
  <div class="modal-overlay" id="gameOverModal">
    <div class="modal">
      <div class="modal-header" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white;">
        üíÄ GAME OVER
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="font-size: 1.2rem; font-weight: bold; color: #dc2626; margin-bottom: 1rem;">
          Your company went bankrupt! üí∏
        </div>
        <div style="background: #f9fafb; border-radius: 8px; padding: 1.5rem; margin: 1rem 0;">
          <div style="font-size: 1.1rem; font-weight: 600; color: #111827; margin-bottom: 1rem;">Final Stats</div>
          <div style="display: grid; gap: 0.75rem; text-align: left;">
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: white; border-radius: 6px;">
              <span style="color: #6b7280;">üìÖ Survived:</span>
              <span style="font-weight: 600; color: #111827;" id="gameOverDays">0 days</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: white; border-radius: 6px;">
              <span style="color: #6b7280;">üì¶ Products Created:</span>
              <span style="font-weight: 600; color: #111827;" id="gameOverProducts">0</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: white; border-radius: 6px;">
              <span style="color: #6b7280;">üë• Team Size:</span>
              <span style="font-weight: 600; color: #111827;" id="gameOverTeam">1</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: white; border-radius: 6px;">
              <span style="color: #6b7280;">üí∞ Final Cash:</span>
              <span style="font-weight: 600; color: #dc2626;" id="gameOverCash">$0</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; gap: 1rem;">
        <button class="btn btn-primary" onclick="restartGame()" style="flex: 1; padding: 1rem; font-size: 1.1rem;">
          üîÑ Restart Game
        </button>
      </div>
    </div>
  </div>

  <!-- Fire Employee Confirmation Modal -->
  <div class="modal-overlay" id="fireEmployeeModal">
    <div class="modal">
      <div class="modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
        üî• Fire Employee
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="font-size: 1.1rem; font-weight: 600; color: #111827; margin-bottom: 1rem;" id="fireEmployeeName">
          Fire Employee Name?
        </div>
        <div style="background: #f9fafb; border-radius: 8px; padding: 1rem; margin: 1rem 0; text-align: left;">
          <div style="display: grid; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #6b7280;">Role:</span>
              <span style="font-weight: 600;" id="fireEmployeeRole">Senior Developer</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #6b7280;">Current Salary:</span>
              <span style="font-weight: 600;" id="fireEmployeeSalary">$7,000/month</span>
            </div>
            <div style="border-top: 1px solid #e5e7eb; margin: 0.5rem 0; padding-top: 0.5rem;"></div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #dc2626; font-weight: 600;">Severance Pay:</span>
              <span style="font-weight: 700; color: #dc2626;" id="fireEmployeeSeverance">$7,000</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #10b981; font-weight: 600;">Monthly Savings:</span>
              <span style="font-weight: 700; color: #10b981;" id="fireEmployeeSavings">$7,000/mo</span>
            </div>
          </div>
        </div>
        <div style="color: #dc2626; font-size: 0.9rem; margin-top: 1rem;">
          ‚ö†Ô∏è This will cost <span id="fireEmployeeCost" style="font-weight: 700;">$7,000</span> immediately.
        </div>
      </div>
      <div class="modal-footer" style="display: flex; gap: 0.5rem;">
        <button class="btn" onclick="hideFireEmployeeModal()" style="flex: 1;">Cancel</button>
        <button class="btn" onclick="confirmFireEmployee()" style="flex: 1; background: #ef4444; border-color: #dc2626; color: white;">
          üî• Confirm Fire
        </button>
      </div>
    </div>
  </div>

  <!-- Downgrade Office Confirmation Modal -->
  <div class="modal-overlay" id="downgradeOfficeModal">
    <div class="modal">
      <div class="modal-header" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white;">
        ‚¨áÔ∏è Downgrade Office
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="font-size: 1.1rem; font-weight: 600; color: #111827; margin-bottom: 1rem;" id="downgradeOfficeName">
          Startup Space ‚Üí Home Office
        </div>
        <div style="background: #f9fafb; border-radius: 8px; padding: 1rem; margin: 1rem 0; text-align: left;">
          <div style="display: grid; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #6b7280;">üë• Capacity:</span>
              <span style="font-weight: 600;" id="downgradeOfficeCapacity">10 ‚Üí 3 people</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #6b7280;">üí∞ Monthly Rent:</span>
              <span style="font-weight: 600;" id="downgradeOfficeRent">$2,000 ‚Üí $0/month</span>
            </div>
            <div style="border-top: 1px solid #e5e7eb; margin: 0.5rem 0; padding-top: 0.5rem;"></div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #10b981; font-weight: 600;">Monthly Savings:</span>
              <span style="font-weight: 700; color: #10b981;" id="downgradeOfficeSavings">$2,000/mo</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #10b981; font-weight: 600;">Upfront Cost:</span>
              <span style="font-weight: 700; color: #10b981;">$0 (Free!)</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; gap: 0.5rem;">
        <button class="btn" onclick="hideDowngradeOfficeModal()" style="flex: 1;">Cancel</button>
        <button class="btn" onclick="confirmDowngradeOffice()" style="flex: 1; background: #6b7280; border-color: #4b5563; color: white;">
          ‚¨áÔ∏è Confirm Downgrade
        </button>
      </div>
    </div>
  </div>

  <!-- Downgrade Server Confirmation Modal -->
  <div class="modal-overlay" id="downgradeServerModal">
    <div class="modal">
      <div class="modal-header" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white;">
        ‚¨áÔ∏è Downgrade Server
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="font-size: 1.1rem; font-weight: 600; color: #111827; margin-bottom: 1rem;" id="downgradeServerName">
          Standard Cloud ‚Üí Basic VPS
        </div>
        <div style="background: #f9fafb; border-radius: 8px; padding: 1rem; margin: 1rem 0; text-align: left;">
          <div style="display: grid; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #6b7280;">üìä Capacity:</span>
              <span style="font-weight: 600;" id="downgradeServerCapacity">5,000 ‚Üí 1,000 subs</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #6b7280;">üí∞ Monthly Fee:</span>
              <span style="font-weight: 600;" id="downgradeServerFee">$150 ‚Üí $50/month</span>
            </div>
            <div style="border-top: 1px solid #e5e7eb; margin: 0.5rem 0; padding-top: 0.5rem;"></div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #10b981; font-weight: 600;">Monthly Savings:</span>
              <span style="font-weight: 700; color: #10b981;" id="downgradeServerSavings">$100/mo</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #10b981; font-weight: 600;">Upfront Cost:</span>
              <span style="font-weight: 700; color: #10b981;">$0 (Free!)</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; gap: 0.5rem;">
        <button class="btn" onclick="hideDowngradeServerModal()" style="flex: 1;">Cancel</button>
        <button class="btn" onclick="confirmDowngradeServer()" style="flex: 1; background: #6b7280; border-color: #4b5563; color: white;">
          ‚¨áÔ∏è Confirm Downgrade
        </button>
      </div>
    </div>
  </div>

  <!-- New Game Setup Modal -->
  <div class="modal-overlay active" id="newGameModal">
    <div class="modal">
      <div class="modal-header">üöÄ Start Your Software Company</div>
      <div class="modal-body">
        <form id="newGameForm">
          <div class="form-group">
            <label>Company Name:</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="companyNameInput" value="TechVentures" required style="flex: 1;">
              <button type="button" class="btn btn-sm" onclick="document.getElementById('companyNameInput').value = generateRandomCompanyName();" style="padding: 0.5rem 1rem;">üé≤</button>
            </div>
          </div>

          <div class="form-group">
            <label>Founder Name:</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="founderNameInput" value="Alex Chen" required style="flex: 1;">
              <button type="button" class="btn btn-sm" onclick="document.getElementById('founderNameInput').value = generateRandomFounderName();" style="padding: 0.5rem 1rem;">üé≤</button>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <!-- Currency Selection -->
            <div class="form-group" style="margin-bottom: 0;">
              <label>Currency:</label>
              <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 2px solid #2563eb; background: #eff6ff; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#2563eb'" onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='#e5e7eb'">
                  <input type="radio" name="currency" value="USD" checked style="margin: 0;" onchange="this.parentElement.parentElement.querySelectorAll('label').forEach(l => {l.style.borderColor='#e5e7eb'; l.style.background='white';}); this.parentElement.style.borderColor='#2563eb'; this.parentElement.style.background='#eff6ff';">
                  <span style="font-weight: 500;">USD ($)</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#2563eb'" onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='#e5e7eb'">
                  <input type="radio" name="currency" value="EUR" style="margin: 0;" onchange="this.parentElement.parentElement.querySelectorAll('label').forEach(l => {l.style.borderColor='#e5e7eb'; l.style.background='white';}); this.parentElement.style.borderColor='#2563eb'; this.parentElement.style.background='#eff6ff';">
                  <span style="font-weight: 500;">EUR (‚Ç¨)</span>
                </label>
              </div>
            </div>

            <!-- Starting Capital -->
            <div class="form-group" style="margin-bottom: 0;">
              <label>Starting Capital:</label>
              <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#2563eb'" onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='#e5e7eb'">
                  <input type="radio" name="capital" value="100000" style="margin: 0;" onchange="this.parentElement.parentElement.querySelectorAll('label').forEach(l => l.style.borderColor='#e5e7eb'); this.parentElement.style.borderColor='#2563eb'; this.parentElement.style.background='#eff6ff';">
                  <div style="flex: 1;">
                    <div style="font-weight: 500; font-size: 0.9rem;">$100k / ‚Ç¨100k</div>
                    <div style="font-size: 0.75rem; color: #6b7280;">Very Easy</div>
                  </div>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#2563eb'" onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='#e5e7eb'">
                  <input type="radio" name="capital" value="50000" style="margin: 0;" onchange="this.parentElement.parentElement.querySelectorAll('label').forEach(l => l.style.borderColor='#e5e7eb'); this.parentElement.style.borderColor='#2563eb'; this.parentElement.style.background='#eff6ff';">
                  <div style="flex: 1;">
                    <div style="font-weight: 500; font-size: 0.9rem;">$50k / ‚Ç¨50k</div>
                    <div style="font-size: 0.75rem; color: #6b7280;">Easy</div>
                  </div>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 2px solid #2563eb; background: #eff6ff; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#2563eb'" onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='#e5e7eb'">
                  <input type="radio" name="capital" value="25000" checked style="margin: 0;" onchange="this.parentElement.parentElement.querySelectorAll('label').forEach(l => {l.style.borderColor='#e5e7eb'; l.style.background='white';}); this.parentElement.style.borderColor='#2563eb'; this.parentElement.style.background='#eff6ff';">
                  <div style="flex: 1;">
                    <div style="font-weight: 500; font-size: 0.9rem;">$25k / ‚Ç¨25k</div>
                    <div style="font-size: 0.75rem; color: #2563eb;">Normal ‚≠ê</div>
                  </div>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#2563eb'" onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='#e5e7eb'">
                  <input type="radio" name="capital" value="10000" style="margin: 0;" onchange="this.parentElement.parentElement.querySelectorAll('label').forEach(l => {l.style.borderColor='#e5e7eb'; l.style.background='white';}); this.parentElement.style.borderColor='#2563eb'; this.parentElement.style.background='#eff6ff';">
                  <div style="flex: 1;">
                    <div style="font-weight: 500; font-size: 0.9rem;">$10k / ‚Ç¨10k</div>
                    <div style="font-size: 0.75rem; color: #6b7280;">Hard</div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" id="startGameBtn" style="font-size: 1.1rem; padding: 0.75rem 2rem;">
          üöÄ Start My Company!
        </button>
      </div>
    </div>
  </div>

  <script>
    /* ============================================ */
    /* SOFTWARE COMPANY SIMULATOR - JAVASCRIPT */
    /* Version 2.0 | Phase 1-2: Core + Products */
    /* ============================================ */

    // ============================================
    // GAME STATE (Global Variables)
    // ============================================
    let currency = "USD";
    let currentDay = 0;
    let cash = 25000;
    let companyName = "My Startup";
    let isPlaying = false;
    let gameSpeed = 1;
    let tickTimer = null;

    let founder = {
      name: "Founder",
      efficiency: 1.0,
      skillLevel: 1,
      experiencePoints: 0,
      assignedProduct: null
    };

    let products = [];
    let developers = [];
    let marketers = [];
    let eventLog = [];

    let currentServerTier = 0; // Shared Hosting (free)
    let currentOfficeTier = 0; // Home Office (no rent)
    
    let nextProductId = 1;

    // ============================================
    // PRODUCT TEMPLATES (15 products)
    // ============================================
    const PRODUCT_TEMPLATES = [
      {
        name: "Task Manager",
        developmentEffort: 3,
        lifetimeMonths: 60,
        monthlyPriceUSD: 19,
        monthlyPriceEUR: 17,
        serverCostPerUser: 0.05,
        description: "Simple to-do list app"
      },
      {
        name: "Time Tracking App",
        developmentEffort: 4,
        lifetimeMonths: 72,
        monthlyPriceUSD: 29,
        monthlyPriceEUR: 27,
        serverCostPerUser: 0.06,
        description: "Employee time logging"
      },
      {
        name: "CRM Lite",
        developmentEffort: 6,
        lifetimeMonths: 96,
        monthlyPriceUSD: 49,
        monthlyPriceEUR: 45,
        serverCostPerUser: 0.1,
        description: "Basic CRM"
      },
      {
        name: "Email Marketing Tool",
        developmentEffort: 8,
        lifetimeMonths: 108,
        monthlyPriceUSD: 59,
        monthlyPriceEUR: 55,
        serverCostPerUser: 0.12,
        description: "Campaign management"
      },
      {
        name: "Analytics Dashboard",
        developmentEffort: 9,
        lifetimeMonths: 84,
        monthlyPriceUSD: 79,
        monthlyPriceEUR: 73,
        serverCostPerUser: 0.15,
        description: "Data viz tool"
      },
      {
        name: "Invoicing Software",
        developmentEffort: 5,
        lifetimeMonths: 120,
        monthlyPriceUSD: 39,
        monthlyPriceEUR: 36,
        serverCostPerUser: 0.08,
        description: "Billing & invoices"
      },
      {
        name: "Project Management Suite",
        developmentEffort: 12,
        lifetimeMonths: 120,
        monthlyPriceUSD: 99,
        monthlyPriceEUR: 92,
        serverCostPerUser: 0.2,
        description: "Full PM tool"
      },
      {
        name: "HR Management System",
        developmentEffort: 14,
        lifetimeMonths: 132,
        monthlyPriceUSD: 119,
        monthlyPriceEUR: 110,
        serverCostPerUser: 0.18,
        description: "Employee management"
      },
      {
        name: "E-commerce Platform",
        developmentEffort: 18,
        lifetimeMonths: 144,
        monthlyPriceUSD: 149,
        monthlyPriceEUR: 138,
        serverCostPerUser: 0.3,
        description: "Online store builder"
      },
      {
        name: "Video Conferencing Tool",
        developmentEffort: 20,
        lifetimeMonths: 96,
        monthlyPriceUSD: 179,
        monthlyPriceEUR: 166,
        serverCostPerUser: 0.35,
        description: "Remote meetings"
      },
      {
        name: "AI Chatbot",
        developmentEffort: 24,
        lifetimeMonths: 72,
        monthlyPriceUSD: 199,
        monthlyPriceEUR: 185,
        serverCostPerUser: 0.4,
        description: "Customer service bot"
      },
      {
        name: "ERP System",
        developmentEffort: 30,
        lifetimeMonths: 180,
        monthlyPriceUSD: 299,
        monthlyPriceEUR: 277,
        serverCostPerUser: 0.5,
        description: "Enterprise resource planning"
      },
      {
        name: "Social Media Manager",
        developmentEffort: 10,
        lifetimeMonths: 84,
        monthlyPriceUSD: 89,
        monthlyPriceEUR: 83,
        serverCostPerUser: 0.16,
        description: "Post scheduling & analytics"
      },
      {
        name: "Password Manager",
        developmentEffort: 7,
        lifetimeMonths: 108,
        monthlyPriceUSD: 49,
        monthlyPriceEUR: 45,
        serverCostPerUser: 0.09,
        description: "Secure credential vault"
      },
      {
        name: "Form Builder",
        developmentEffort: 5,
        lifetimeMonths: 72,
        monthlyPriceUSD: 35,
        monthlyPriceEUR: 32,
        serverCostPerUser: 0.07,
        description: "Drag-and-drop forms"
      }
    ];

    // ============================================
    // EMPLOYEE & OFFICE TIERS (Phase 3)
    // ============================================
    const DEVELOPER_TIERS = [
      {
        name: "Junior Developer",
        skill: "junior",
        efficiency: 0.5,
        monthlySalaryUSD: 3000,
        monthlySalaryEUR: 2700
      },
      {
        name: "Intermediate Developer",
        skill: "intermediate",
        efficiency: 1.0,
        monthlySalaryUSD: 5000,
        monthlySalaryEUR: 4500
      },
      {
        name: "Senior Developer",
        skill: "senior",
        efficiency: 1.5,
        monthlySalaryUSD: 7000,
        monthlySalaryEUR: 6300
      },
      {
        name: "Lead Developer",
        skill: "lead",
        efficiency: 2.0,
        monthlySalaryUSD: 9000,
        monthlySalaryEUR: 8100
      },
      {
        name: "Expert Developer",
        skill: "expert",
        efficiency: 3.0,
        monthlySalaryUSD: 12000,
        monthlySalaryEUR: 10800
      }
    ];

    const MARKETER_TIERS = [
      {
        name: "Junior Marketer",
        skill: "junior",
        efficiency: 0.5,
        monthlySalaryUSD: 2500,
        monthlySalaryEUR: 2250
      },
      {
        name: "Intermediate Marketer",
        skill: "intermediate",
        efficiency: 1.0,
        monthlySalaryUSD: 4000,
        monthlySalaryEUR: 3600
      },
      {
        name: "Senior Marketer",
        skill: "senior",
        efficiency: 1.5,
        monthlySalaryUSD: 5500,
        monthlySalaryEUR: 4950
      },
      {
        name: "Lead Marketer",
        skill: "lead",
        efficiency: 2.0,
        monthlySalaryUSD: 7000,
        monthlySalaryEUR: 6300
      },
      {
        name: "Expert Marketer",
        skill: "expert",
        efficiency: 3.0,
        monthlySalaryUSD: 10000,
        monthlySalaryEUR: 9000
      }
    ];

    const OFFICE_TIERS = [
      {
        name: "Home Office",
        capacity: 3,
        monthlyRentUSD: 0,
        monthlyRentEUR: 0,
        utilitiesBaseUSD: 100,
        utilitiesBaseEUR: 90,
        utilitiesPerPersonUSD: 50,
        utilitiesPerPersonEUR: 45
      },
      {
        name: "Small Office",
        capacity: 8,
        monthlyRentUSD: 1500,
        monthlyRentEUR: 1350,
        utilitiesBaseUSD: 200,
        utilitiesBaseEUR: 180,
        utilitiesPerPersonUSD: 40,
        utilitiesPerPersonEUR: 36
      },
      {
        name: "Medium Office",
        capacity: 15,
        monthlyRentUSD: 3000,
        monthlyRentEUR: 2700,
        utilitiesBaseUSD: 350,
        utilitiesBaseEUR: 315,
        utilitiesPerPersonUSD: 35,
        utilitiesPerPersonEUR: 31
      },
      {
        name: "Large Office",
        capacity: 30,
        monthlyRentUSD: 6000,
        monthlyRentEUR: 5400,
        utilitiesBaseUSD: 600,
        utilitiesBaseEUR: 540,
        utilitiesPerPersonUSD: 30,
        utilitiesPerPersonEUR: 27
      },
      {
        name: "Enterprise HQ",
        capacity: 100,
        monthlyRentUSD: 15000,
        monthlyRentEUR: 13500,
        utilitiesBaseUSD: 1200,
        utilitiesBaseEUR: 1080,
        utilitiesPerPersonUSD: 25,
        utilitiesPerPersonEUR: 22
      }
    ];

    const SERVER_TIERS = [
      {
        name: "Shared Hosting",
        maxSubscribers: 100,
        monthlyFeeUSD: 0,      // Free tier
        monthlyFeeEUR: 0,
        upgradeCostUSD: 0,
        upgradeCostEUR: 0
      },
      {
        name: "VPS Basic",
        maxSubscribers: 500,
        monthlyFeeUSD: 50,
        monthlyFeeEUR: 45,
        upgradeCostUSD: 200,
        upgradeCostEUR: 180
      },
      {
        name: "VPS Standard",
        maxSubscribers: 2000,
        monthlyFeeUSD: 200,
        monthlyFeeEUR: 180,
        upgradeCostUSD: 800,
        upgradeCostEUR: 720
      },
      {
        name: "VPS Premium",
        maxSubscribers: 5000,
        monthlyFeeUSD: 500,
        monthlyFeeEUR: 450,
        upgradeCostUSD: 2000,
        upgradeCostEUR: 1800
      },
      {
        name: "Dedicated Server",
        maxSubscribers: 15000,
        monthlyFeeUSD: 1200,
        monthlyFeeEUR: 1080,
        upgradeCostUSD: 5000,
        upgradeCostEUR: 4500
      },
      {
        name: "Cloud Infrastructure",
        maxSubscribers: 50000,
        monthlyFeeUSD: 3000,
        monthlyFeeEUR: 2700,
        upgradeCostUSD: 15000,
        upgradeCostEUR: 13500
      },
      {
        name: "Enterprise Cloud",
        maxSubscribers: 999999, // Unlimited
        monthlyFeeUSD: 8000,
        monthlyFeeEUR: 7200,
        upgradeCostUSD: 0,       // No more upgrades
        upgradeCostEUR: 0
      }
    ];

    const FIRST_NAMES = [
      "Alex", "Jamie", "Jordan", "Taylor", "Morgan", "Casey", "Riley", "Avery", "Quinn", "Sage",
      "Emma", "Liam", "Olivia", "Noah", "Ava", "Ethan", "Sophia", "Mason", "Isabella", "William",
      "Mia", "James", "Charlotte", "Benjamin", "Amelia", "Lucas", "Harper", "Henry", "Evelyn", "Alexander",
      "Abigail", "Michael", "Emily", "Daniel", "Elizabeth", "Matthew", "Sofia", "David", "Ella", "Joseph",
      "Madison", "Samuel", "Scarlett", "Jackson", "Victoria", "Sebastian", "Aria", "Jack", "Grace", "Aiden"
    ];

    const LAST_NAMES = [
      "Smith", "Johnson", "Williams", "Brown", "Jones", "Garcia", "Miller", "Davis", "Rodriguez", "Martinez",
      "Hernandez", "Lopez", "Gonzalez", "Wilson", "Anderson", "Thomas", "Taylor", "Moore", "Jackson", "Martin",
      "Lee", "Perez", "Thompson", "White", "Harris", "Sanchez", "Clark", "Ramirez", "Lewis", "Robinson",
      "Walker", "Young", "Allen", "King", "Wright", "Scott", "Torres", "Nguyen", "Hill", "Flores",
      "Green", "Adams", "Nelson", "Baker", "Hall", "Rivera", "Campbell", "Mitchell", "Carter", "Roberts"
    ];

    const COMPANY_PREFIXES = [
      "Quantum", "Cyber", "Tech", "Digital", "Cloud", "Smart", "Innovative", "Next", "Future", "Apex",
      "Peak", "Prime", "Elite", "Stellar", "Zenith", "Nexus", "Vertex", "Pivot", "Spark", "Swift",
      "Agile", "Bright", "Clear", "Dynamic", "Epic", "Flash", "Global", "Hyper", "Infinite", "Kinetic"
    ];

    const COMPANY_SUFFIXES = [
      "Solutions", "Systems", "Technologies", "Software", "Labs", "Works", "Studios", "Ventures", "Innovations", "Digital",
      "Tech", "Apps", "Cloud", "Data", "AI", "Logic", "Dynamics", "Platform", "Services", "Group",
      "Media", "Networks", "Interactive", "Designs", "Development", "Engineering", "Products", "Analytics", "Hub", "Core"
    ];

    let nextEmployeeId = 1;

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function formatCurrency(amount) {
      const rounded = Math.round(amount);
      const formatted = rounded.toLocaleString();
      return currency === "USD" ? `$${formatted}` : `‚Ç¨${formatted}`;
    }

    function logEvent(message) {
      const event = {
        day: currentDay,
        message: message
      };
      eventLog.unshift(event); // Add to beginning
      if (eventLog.length > 50) eventLog.pop(); // Keep last 50
      updateEventLog();
    }

    function updateEventLog() {
      const container = document.getElementById('eventLog');
      const mobileContainer = document.getElementById('eventLogMobile');
      
      const logHTML = eventLog.slice(0, 20).map(e => 
        `<div class="event">Day ${e.day}: ${e.message}</div>`
      ).join('');
      
      container.innerHTML = logHTML;
      if (mobileContainer) {
        mobileContainer.innerHTML = logHTML;
      }
    }

    function updateCashDisplay() {
      const display = document.getElementById('cashDisplay');
      display.textContent = formatCurrency(cash);
      
      // Color coding
      display.className = 'cash-display';
      if (cash < 0) {
        display.classList.add('flashing-red');
      } else if (cash < 5000) {
        display.classList.add('red');
      } else if (cash < 20000) {
        display.classList.add('yellow');
      } else {
        display.classList.add('green');
      }
    }

    function updateDayDisplay() {
      document.getElementById('dayCounter').textContent = currentDay;
      const year = Math.floor(currentDay / 360);
      const month = Math.floor((currentDay % 360) / 30);
      document.getElementById('yearMonth').textContent = `Year ${year}, Month ${month}`;
    }

    function updateFounderDisplay() {
      const xp = Math.floor(founder.experiencePoints);
      document.getElementById('founderLevel').textContent = founder.skillLevel;
      document.getElementById('founderXP').textContent = xp;
      
      // Update tooltip
      document.getElementById('founderName').textContent = founder.name;
      document.getElementById('tooltipLevel').textContent = founder.skillLevel;
      document.getElementById('tooltipEfficiency').textContent = Math.round(founder.efficiency * 100);
      document.getElementById('tooltipCurrentXP').textContent = xp;
      
      // Calculate XP needed for next level
      let nextLevelXP = 100;
      if (founder.skillLevel === 1) nextLevelXP = 100;
      else if (founder.skillLevel === 2) nextLevelXP = 250;
      else if (founder.skillLevel === 3) nextLevelXP = 500;
      else if (founder.skillLevel === 4) nextLevelXP = 1000;
      else nextLevelXP = 1000; // Max level
      
      document.getElementById('tooltipNextLevelXP').textContent = nextLevelXP;
      
      // Update current assignment
      const assignmentEl = document.getElementById('tooltipCurrentAssignment');
      if (founder.assignedProduct) {
        const product = products.find(p => p.id === founder.assignedProduct);
        if (product) {
          const isDeveloper = product.assignedDevelopers.includes('founder');
          const isMarketer = product.assignedMarketers.includes('founder');
          
          if (isDeveloper) {
            assignmentEl.textContent = `üë®‚Äçüíª Developing: ${product.name}`;
          } else if (isMarketer) {
            assignmentEl.textContent = `üì¢ Marketing: ${product.name}`;
          } else {
            assignmentEl.textContent = 'Not assigned';
          }
        } else {
          assignmentEl.textContent = 'Not assigned';
        }
      } else {
        assignmentEl.textContent = 'Not assigned';
      }
      
      const xpNeeded = Math.max(0, nextLevelXP - xp);
      document.getElementById('tooltipXPNeeded').textContent = xpNeeded;
      
      // Update progress bar
      const progressPercent = founder.skillLevel >= 5 ? 100 : Math.min(100, (xp / nextLevelXP) * 100);
      document.getElementById('xpProgressBar').style.width = progressPercent + '%';
    }

    // ============================================
    // PHASE 2: PRODUCT FUNCTIONS
    // ============================================
    function createProduct(template) {
      // Check if product with same name already exists and is not deprecated
      const existingProduct = products.find(p => p.name === template.name && p.status !== "deprecated");
      
      if (existingProduct) {
        const statusText = existingProduct.status === "in_development" ? "still in development" : "still active";
        logEvent(`‚ùå Cannot create "${template.name}" - one is ${statusText}. Wait for it to be deprecated first.`);
        return;
      }
      
      const product = {
        id: nextProductId++,
        name: template.name,
        developmentEffort: template.developmentEffort,
        currentProgress: 0,
        status: "in_development",
        publishDate: null,
        lifetimeMonths: template.lifetimeMonths,
        remainingLifetimeMonths: template.lifetimeMonths,
        deprecationDate: null,
        monthlyPrice: currency === "USD" ? template.monthlyPriceUSD : template.monthlyPriceEUR,
        subscribers: 0,
        churnRate: 0.05,
        marketingMultiplier: 1.0,
        serverCostPerUser: template.serverCostPerUser,
        assignedDevelopers: [], // No auto-assignment
        assignedMarketers: []
      };
      
      products.push(product);
      
      logEvent(`üìã Created "${product.name}" - assign developers to start building!`);
      updateProductsUI();
    }
    
    function assignFounderToProduct(productId) {
      // Unassign founder from all products first (both dev and marketing)
      products.forEach(p => {
        const devIndex = p.assignedDevelopers.indexOf('founder');
        if (devIndex > -1) {
          p.assignedDevelopers.splice(devIndex, 1);
        }
        const mktIndex = p.assignedMarketers.indexOf('founder');
        if (mktIndex > -1) {
          p.assignedMarketers.splice(mktIndex, 1);
        }
      });
      
      // Assign to new product as developer
      const product = products.find(p => p.id === productId);
      if (product) {
        product.assignedDevelopers.push('founder');
        founder.assignedProduct = productId;
        logEvent(`üë®‚Äçüíº ${founder.name} assigned to develop "${product.name}"`);
      }
      
      updateProductsUI();
    }
    
    function assignFounderToProductAsMarketer(productId) {
      // Unassign founder from all products first (both dev and marketing)
      products.forEach(p => {
        const devIndex = p.assignedDevelopers.indexOf('founder');
        if (devIndex > -1) {
          p.assignedDevelopers.splice(devIndex, 1);
        }
        const mktIndex = p.assignedMarketers.indexOf('founder');
        if (mktIndex > -1) {
          p.assignedMarketers.splice(mktIndex, 1);
        }
      });
      
      // Assign to new product as marketer
      const product = products.find(p => p.id === productId);
      if (product) {
        product.assignedMarketers.push('founder');
        founder.assignedProduct = productId;
        logEvent(`üì¢ ${founder.name} assigned to market "${product.name}"`);
      }
      
      updateProductsUI();
    }
    
    function unassignFounderFromProduct(productId) {
      const product = products.find(p => p.id === productId);
      if (product) {
        // Check both developer and marketer assignments
        const devIndex = product.assignedDevelopers.indexOf('founder');
        const mktIndex = product.assignedMarketers.indexOf('founder');
        
        if (devIndex > -1) {
          product.assignedDevelopers.splice(devIndex, 1);
          founder.assignedProduct = null;
          logEvent(`üë®‚Äçüíº ${founder.name} unassigned from developing "${product.name}"`);
        } else if (mktIndex > -1) {
          product.assignedMarketers.splice(mktIndex, 1);
          founder.assignedProduct = null;
          logEvent(`üì¢ ${founder.name} unassigned from marketing "${product.name}"`);
        }
      }
      
      updateProductsUI();
    }
    
    function assignEmployeeToProduct(employeeId, productId) {
      const employee = [...developers, ...marketers].find(e => e.id === employeeId);
      const product = products.find(p => p.id === productId);
      
      if (!employee || !product) return;
      
      // Unassign from previous product
      if (employee.assignedProduct) {
        const oldProduct = products.find(p => p.id === employee.assignedProduct);
        if (oldProduct) {
          if (employee.role === 'developer') {
            const index = oldProduct.assignedDevelopers.indexOf(employeeId);
            if (index > -1) oldProduct.assignedDevelopers.splice(index, 1);
          } else {
            const index = oldProduct.assignedMarketers.indexOf(employeeId);
            if (index > -1) oldProduct.assignedMarketers.splice(index, 1);
          }
        }
      }
      
      // Assign to new product
      employee.assignedProduct = productId;
      if (employee.role === 'developer' && product.status === 'in_development') {
        product.assignedDevelopers.push(employeeId);
        logEvent(`üë®‚Äçüíª ${employee.name} assigned to develop "${product.name}"`);
      } else if (employee.role === 'marketer' && product.status === 'published') {
        product.assignedMarketers.push(employeeId);
        logEvent(`üì¢ ${employee.name} assigned to market "${product.name}"`);
      }
      
      updateProductsUI();
      updateEmployeesUI();
    }
    
    function unassignEmployeeFromProduct(employeeId) {
      const employee = [...developers, ...marketers].find(e => e.id === employeeId);
      if (!employee || !employee.assignedProduct) return;
      
      const product = products.find(p => p.id === employee.assignedProduct);
      if (product) {
        if (employee.role === 'developer') {
          const index = product.assignedDevelopers.indexOf(employeeId);
          if (index > -1) product.assignedDevelopers.splice(index, 1);
        } else {
          const index = product.assignedMarketers.indexOf(employeeId);
          if (index > -1) product.assignedMarketers.splice(index, 1);
        }
        logEvent(`${employee.role === 'developer' ? 'üë®‚Äçüíª' : 'üì¢'} ${employee.name} unassigned from "${product.name}"`);
      }
      
      employee.assignedProduct = null;
      updateProductsUI();
      updateEmployeesUI();
    }
    
    function updateProductDevelopment() {
      products.forEach(product => {
        if (product.status === 'in_development') {
          let dailyProgress = 0;
          
          // Founder contribution
          if (product.assignedDevelopers.includes('founder')) {
            const contribution = founder.efficiency / 30; // 1 month = 30 days
            dailyProgress += contribution;
            founder.experiencePoints += contribution * 10; // 10 XP per man-month
          }
          
          // Employee developer contributions
          product.assignedDevelopers.forEach(devId => {
            if (devId !== 'founder') {
              const developer = developers.find(d => d.id === devId);
              if (developer) {
                const contribution = developer.efficiency / 30;
                dailyProgress += contribution;
              }
            }
          });
          
          product.currentProgress += dailyProgress;
          
          // Check if completed
          if (product.currentProgress >= product.developmentEffort) {
            publishProduct(product);
          }
        }
      });
      
      // Check for founder level up
      checkFounderLevelUp();
    }
    
    function publishProduct(product) {
      product.status = 'published';
      product.publishDate = currentDay;
      product.currentProgress = product.developmentEffort; // Cap at 100%
      
      // Auto-unassign all developers (including founder) since development is complete
      if (product.assignedDevelopers.includes('founder')) {
        founder.assignedProduct = null;
        logEvent(`üë®‚Äçüíº ${founder.name} unassigned from development (product published)`);
      }
      product.assignedDevelopers = [];
      
      logEvent(`üéâ "${product.name}" published and ready for customers!`);
      updateProductsUI();
    }
    
    function checkProductLifecycles() {
      products.forEach(product => {
        if (product.status === 'published') {
          const monthsSincePublish = (currentDay - product.publishDate) / 30;
          product.remainingLifetimeMonths = product.lifetimeMonths - monthsSincePublish;
          
          if (product.remainingLifetimeMonths <= 0) {
            product.status = 'deprecated';
            product.deprecationDate = currentDay;
            product.remainingLifetimeMonths = 0;
            
            // Auto-unassign all marketers (including founder) since product is end-of-life
            if (product.assignedMarketers.includes('founder')) {
              founder.assignedProduct = null;
              logEvent(`üì¢ ${founder.name} unassigned from marketing (product deprecated)`);
            }
            product.assignedMarketers = [];
            
            logEvent(`‚ò†Ô∏è "${product.name}" is now deprecated (end of life)`);
            updateProductsUI();
          }
        }
      });
    }
    
    function updateCustomerAcquisition() {
      // Check server capacity first
      const server = SERVER_TIERS[currentServerTier];
      const totalSubs = getTotalSubscribers();
      const availableCapacity = server.maxSubscribers - totalSubs;
      
      products.forEach(product => {
        if (product.status === 'published') {
          let dailyGrowth = 0;
          
          // Organic growth (word of mouth, search, etc.)
          // Base: 0.5-1 subscribers per day + small bonus based on existing user base
          const organicBase = 0.5 + (Math.random() * 0.5); // 0.5 to 1.0 per day
          const wordOfMouthBonus = Math.sqrt(product.subscribers) * 0.01; // Scales slowly with subscriber count
          dailyGrowth += organicBase + wordOfMouthBonus;
          
          // Marketer contributions (much higher than organic)
          product.assignedMarketers.forEach(mktId => {
            if (mktId === 'founder') {
              // Founder as marketer
              dailyGrowth += 5 * founder.efficiency;
            } else {
              const marketer = marketers.find(m => m.id === mktId);
              if (marketer) {
                // Base growth: 5 subscribers per day per 1x marketer
                dailyGrowth += 5 * marketer.efficiency;
              }
            }
          });
          
          // Calculate potential growth
          const randomFactor = 0.8 + (Math.random() * 0.4); // 80%-120%
          const potentialGrowth = Math.max(1, Math.round(dailyGrowth * randomFactor));
          
          // Check server capacity before adding subscribers
          const currentTotalSubs = getTotalSubscribers();
          const actualGrowth = Math.min(potentialGrowth, server.maxSubscribers - currentTotalSubs);
          
          if (actualGrowth > 0) {
            product.subscribers += actualGrowth;
          } else if (potentialGrowth > 0 && actualGrowth === 0) {
            // Server is full, log once per day (only for first product that hits limit)
            const lastWarningDay = product.lastCapacityWarning || -999;
            if (currentDay > lastWarningDay) {
              logEvent(`‚ö†Ô∏è Server full! "${product.name}" cannot gain subscribers. Upgrade server!`);
              product.lastCapacityWarning = currentDay;
            }
          }
          
          // Normal churn for published products (much lower than deprecated)
          // Churn rate: 1-2% of subscribers leave per day
          if (product.subscribers > 10) { // Only apply churn if there are enough subscribers
            const normalChurnRate = 0.01 + (Math.random() * 0.01); // 1-2% daily churn
            const subscribersLost = Math.ceil(product.subscribers * normalChurnRate);
            product.subscribers = Math.max(0, product.subscribers - subscribersLost);
          }
        }
        
        // Deprecated products lose subscribers over time
        if (product.status === 'deprecated' && product.subscribers > 0) {
          // Churn rate: 10-15% of subscribers leave per day
          const churnRate = 0.10 + (Math.random() * 0.05); // 10-15% daily churn
          const subscribersLost = Math.max(1, Math.ceil(product.subscribers * churnRate));
          const previousSubscribers = product.subscribers;
          product.subscribers = Math.max(0, product.subscribers - subscribersLost);
          
          // Log when product fully dies (last subscriber leaves)
          if (previousSubscribers > 0 && product.subscribers === 0) {
            logEvent(`üíÄ "${product.name}" has lost all subscribers and is now hidden. You can create it again!`);
          }
        }
      });
    }
    
    function checkFounderLevelUp() {
      const xp = founder.experiencePoints;
      let newLevel = founder.skillLevel;
      let newEfficiency = founder.efficiency;
      
      if (xp >= 1000 && founder.skillLevel < 5) {
        newLevel = 5;
        newEfficiency = 1.5;
      } else if (xp >= 500 && founder.skillLevel < 4) {
        newLevel = 4;
        newEfficiency = 1.3;
      } else if (xp >= 250 && founder.skillLevel < 3) {
        newLevel = 3;
        newEfficiency = 1.2;
      } else if (xp >= 100 && founder.skillLevel < 2) {
        newLevel = 2;
        newEfficiency = 1.1;
      }
      
      if (newLevel > founder.skillLevel) {
        founder.skillLevel = newLevel;
        founder.efficiency = newEfficiency;
        logEvent(`üåü ${founder.name} leveled up to Level ${newLevel}! Efficiency: ${Math.round(newEfficiency * 100)}%`);
        updateFounderDisplay();
      }
    }
    
    function updateProductsUI() {
      const container = document.getElementById('productsContainer');
      
      // Filter out deprecated products with 0 subscribers (they're done, hide them)
      const visibleProducts = products.filter(p => {
        return !(p.status === 'deprecated' && p.subscribers === 0);
      });
      
      if (visibleProducts.length === 0) {
        container.innerHTML = '<div class="empty-state">No products yet. Start building!</div>';
        return;
      }
      
      container.innerHTML = visibleProducts.map(product => {
        let html = '<div class="product-card ' + product.status + '">';
        
        // Header
        html += '<div class="product-header">';
        html += '<div class="product-name">' + product.name + '</div>';
        html += '<div class="product-status status-' + (product.status === 'in_development' ? 'dev' : product.status) + '">';
        html += product.status === 'in_development' ? 'In Development' : 
                product.status === 'published' ? 'Live' : 'Deprecated';
        html += '</div>';
        html += '</div>';
        
        // In Development
        if (product.status === 'in_development') {
          const progress = Math.min(100, (product.currentProgress / product.developmentEffort) * 100);
          html += '<div class="progress-bar">';
          html += '<div class="progress-fill" style="width: ' + progress + '%">' + Math.round(progress) + '%</div>';
          html += '</div>';
          html += '<div class="product-info">';
          html += '<strong>Progress:</strong> ' + product.currentProgress.toFixed(2) + ' / ' + product.developmentEffort + ' man-months<br>';
          
          // Show assigned developers
          if (product.assignedDevelopers.length > 0) {
            html += '<strong>Assigned:</strong> ';
            const devNames = product.assignedDevelopers.map(id => {
              if (id === 'founder') return founder.name + ' (Founder)';
              const developer = developers.find(d => d.id === id);
              if (developer) {
                const skillLabel = developer.skill.charAt(0).toUpperCase() + developer.skill.slice(1);
                return developer.name + ' (' + skillLabel + ')';
              }
              return 'Developer #' + id;
            });
            html += devNames.join(', ') + '<br>';
            
            // Calculate estimated completion with current team
            let totalEfficiency = 0;
            if (product.assignedDevelopers.includes('founder')) {
              totalEfficiency += founder.efficiency;
            }
            // Add hired developers' efficiency
            product.assignedDevelopers.forEach(devId => {
              if (devId !== 'founder') {
                const developer = developers.find(d => d.id === devId);
                if (developer) {
                  totalEfficiency += developer.efficiency;
                }
              }
            });
            const daysLeft = totalEfficiency > 0 ? 
              Math.ceil((product.developmentEffort - product.currentProgress) / (totalEfficiency / 30)) : 
              '‚àû';
            html += '<strong>Est. completion:</strong> ' + (daysLeft === '‚àû' ? 'Never (no developers assigned!)' : '~' + daysLeft + ' days');
          } else {
            html += '<strong>‚ö†Ô∏è No developers assigned!</strong> Assign developers to start building.';
          }
          html += '</div>';
          
          // Assignment section - only show assigned developers
          html += '<div style="margin-top: 0.75rem; padding: 0.75rem; background: #f9fafb; border-radius: 6px;">';
          html += '<div style="font-weight: bold; font-size: 0.85rem; color: #374151; margin-bottom: 0.5rem;">üë• Development Team:</div>';
          
          html += '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">';
          
          // Show assigned developers only
          const founderAssigned = product.assignedDevelopers.includes('founder');
          if (founderAssigned) {
            html += '<div class="assigned-person-card">';
            html += '<span class="assigned-person-name">' + founder.name + ' <span class="person-role">(Founder)</span></span>';
            html += '<button class="unassign-btn" onclick="unassignFounderFromProduct(' + product.id + ')">‚úñ</button>';
            html += '</div>';
          }
          
          // Assigned developers
          product.assignedDevelopers.forEach(devId => {
            if (devId !== 'founder') {
              const dev = developers.find(d => d.id === devId);
              if (dev) {
                const skillLabel = dev.skill.charAt(0).toUpperCase() + dev.skill.slice(1);
                html += '<div class="assigned-person-card">';
                html += '<span class="assigned-person-name">' + dev.name + ' <span class="person-role">(' + skillLabel + ')</span></span>';
                html += '<button class="unassign-btn" onclick="unassignEmployeeFromProduct(' + dev.id + ')">‚úñ</button>';
                html += '</div>';
              }
            }
          });
          
          // Add developer button
          html += '<button class="add-person-btn" onclick="showAssignDeveloperModal(' + product.id + ')">‚ûï Add Developer</button>';
          
          html += '</div>';
          html += '</div>';
        }
        
        // Published
        if (product.status === 'published') {
          const monthlyRevenue = product.subscribers * product.monthlyPrice;
          const monthlyServerCost = product.subscribers * product.serverCostPerUser;
          const monthlyNetRevenue = monthlyRevenue - monthlyServerCost;
          
          html += '<div class="product-info">';
          html += '<strong>Subscribers:</strong> ' + product.subscribers + '<br>';
          html += '<strong>Monthly Revenue:</strong> ' + formatCurrency(monthlyNetRevenue) + ' <span style="font-size: 0.85rem; color: #6b7280;">(net)</span><br>';
          html += '<span style="font-size: 0.85rem; color: #6b7280;">Revenue: ' + formatCurrency(monthlyRevenue) + ' - Server: ' + formatCurrency(monthlyServerCost) + '</span><br>';
          html += '<strong>Price:</strong> ' + formatCurrency(product.monthlyPrice) + '/mo per customer';
          html += '</div>';
          
          // Lifetime indicator
          const monthsLeft = Math.round(product.remainingLifetimeMonths);
          let lifetimeClass = 'lifetime-green';
          if (monthsLeft < 6) lifetimeClass = 'lifetime-red';
          else if (monthsLeft < 12) lifetimeClass = 'lifetime-orange';
          else if (monthsLeft < 36) lifetimeClass = 'lifetime-yellow';
          
          const yearsLeft = Math.floor(monthsLeft / 12);
          const remainingMonths = monthsLeft % 12;
          let lifetimeText = '';
          if (yearsLeft > 0) lifetimeText = yearsLeft + ' year' + (yearsLeft > 1 ? 's' : '');
          if (remainingMonths > 0) {
            if (lifetimeText) lifetimeText += ', ';
            lifetimeText += remainingMonths + ' month' + (remainingMonths > 1 ? 's' : '');
          }
          
          html += '<div class="lifetime-indicator ' + lifetimeClass + '">';
          html += '‚è≥ ' + lifetimeText + ' remaining';
          html += '</div>';
          
          // Marketer assignment - only show assigned marketers
          html += '<div style="margin-top: 0.75rem; padding: 0.75rem; background: #fef3f4; border-radius: 6px;">';
          html += '<div style="font-weight: bold; font-size: 0.85rem; color: #be185d; margin-bottom: 0.5rem;">üì¢ Marketing Team:</div>';
          
          html += '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">';
          
          // Show assigned marketers only
          const founderAssignedAsMarketer = product.assignedMarketers.includes('founder');
          if (founderAssignedAsMarketer) {
            html += '<div class="assigned-person-card">';
            html += '<span class="assigned-person-name">' + founder.name + ' <span class="person-role">(Founder)</span></span>';
            html += '<button class="unassign-btn" onclick="unassignFounderFromProduct(' + product.id + ')">‚úñ</button>';
            html += '</div>';
          }
          
          // Assigned marketers
          product.assignedMarketers.forEach(mktId => {
            if (mktId !== 'founder') {
              const mkt = marketers.find(m => m.id === mktId);
              if (mkt) {
                const skillLabel = mkt.skill.charAt(0).toUpperCase() + mkt.skill.slice(1);
                html += '<div class="assigned-person-card">';
                html += '<span class="assigned-person-name">' + mkt.name + ' <span class="person-role">(' + skillLabel + ')</span></span>';
                html += '<button class="unassign-btn" onclick="unassignEmployeeFromProduct(' + mkt.id + ')">‚úñ</button>';
                html += '</div>';
              }
            }
          });
          
          // Add marketer button
          html += '<button class="add-person-btn" onclick="showAssignMarketerModal(' + product.id + ')">‚ûï Add Marketer</button>';
          
          html += '</div>';
          html += '</div>';
        }
        
        // Deprecated
        if (product.status === 'deprecated') {
          const deprecatedRevenue = product.subscribers * product.monthlyPrice;
          const deprecatedServerCost = product.subscribers * product.serverCostPerUser;
          const deprecatedNetRevenue = deprecatedRevenue - deprecatedServerCost;
          
          html += '<div class="product-info">';
          html += '<strong>‚ö†Ô∏è END OF LIFE</strong><br>';
          html += 'Remaining subscribers: ' + product.subscribers + ' (declining fast)<br>';
          html += 'Revenue: ' + formatCurrency(deprecatedNetRevenue) + '/mo <span style="font-size: 0.85rem; color: #6b7280;">(net)</span>';
          html += '</div>';
        }
        
        html += '</div>';
        return html;
      }).join('');
    }
    
    function showNewProductModal() {
      const modal = document.getElementById('newProductModal');
      const list = document.getElementById('productTemplatesList');
      
      // Find first available template index for default selection
      let firstAvailableIndex = -1;
      for (let i = 0; i < PRODUCT_TEMPLATES.length; i++) {
        const existing = products.find(p => p.name === PRODUCT_TEMPLATES[i].name && p.status !== "deprecated");
        if (!existing) {
          firstAvailableIndex = i;
          break;
        }
      }
      
      // Render product templates
      list.innerHTML = PRODUCT_TEMPLATES.map((template, index) => {
        const price = currency === "USD" ? 
          `$${template.monthlyPriceUSD}/mo` : 
          `‚Ç¨${template.monthlyPriceEUR}/mo`;
        
        const years = Math.floor(template.lifetimeMonths / 12);
        const remainingMonths = template.lifetimeMonths % 12;
        const lifeDisplay = remainingMonths > 0 ? 
          `${years}y ${remainingMonths}m` : 
          `${years} years`;
        
        // Check if this product already exists and is not deprecated
        const existingProduct = products.find(p => p.name === template.name && p.status !== "deprecated");
        const isDisabled = existingProduct !== undefined;
        const disabledClass = isDisabled ? 'disabled' : '';
        const statusNote = isDisabled ? 
          `<div style="color: #ef4444; font-size: 0.85rem; margin-top: 0.25rem;">‚ö†Ô∏è Already exists (${existingProduct.status === "in_development" ? "in development" : "active"})</div>` : 
          '';
        
        return `
          <label class="product-template ${disabledClass}">
            <input type="radio" name="productTemplate" value="${index}" ${index === firstAvailableIndex ? 'checked' : ''} ${isDisabled ? 'disabled' : ''}>
            <div class="template-content">
              <div class="template-name">${template.name}</div>
              <div class="template-details">
                <div class="template-detail">üìÖ ${template.developmentEffort} months dev</div>
                <div class="template-detail">‚è≥ ${lifeDisplay} lifetime</div>
                <div class="template-detail">üí∞ ${price}</div>
                <div class="template-detail">üñ•Ô∏è ${template.serverCostPerUser}/user</div>
              </div>
              <div class="template-description">${template.description}</div>
              ${statusNote}
            </div>
          </label>
        `;
      }).join('');
      
      modal.classList.add('active');
    }
    
    function hideNewProductModal() {
      document.getElementById('newProductModal').classList.remove('active');
    }
    
    function handleCreateProduct() {
      const selectedIndex = parseInt(document.querySelector('input[name="productTemplate"]:checked').value);
      const template = PRODUCT_TEMPLATES[selectedIndex];
      
      createProduct(template);
      hideNewProductModal();
    }

    // ============================================
    // GAME LOOP
    // ============================================
    function startGame() {
      if (isPlaying) return;
      isPlaying = true;
      updateSpeedButtons();
      gameTick();
      
      // Hide pause banner
      document.getElementById('pauseBanner').classList.remove('active');
    }

    function pauseGame() {
      isPlaying = false;
      if (tickTimer) clearTimeout(tickTimer);
      updateSpeedButtons();
      
      // Show pause banner
      document.getElementById('pauseBanner').classList.add('active');
    }

    function setGameSpeed(speed) {
      gameSpeed = speed;
      updateSpeedButtons();
      if (isPlaying) {
        // Restart with new speed
        pauseGame();
        startGame();
      }
    }

    function updateSpeedButtons() {
      document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
      if (!isPlaying) {
        document.getElementById('pauseBtn').classList.add('active');
      } else {
        if (gameSpeed === 1) document.getElementById('playBtn').classList.add('active');
        else if (gameSpeed === 2) document.getElementById('speed2xBtn').classList.add('active');
        else if (gameSpeed === 5) document.getElementById('speed5xBtn').classList.add('active');
      }
    }

    function gameTick() {
      currentDay++;
      updateDayDisplay();
      updateCashDisplay();

      // Phase 2: Product development
      updateProductDevelopment();
      
      // Check product lifecycles daily
      checkProductLifecycles();
      
      // Phase 3: Customer acquisition (daily)
      updateCustomerAcquisition();
      
      // Phase 3: Monthly billing (every 30 days)
      if (currentDay % 30 === 0) {
        handleMonthlyBilling();
      }
      
      // Update UI
      updateFounderDisplay();
      updateProductsUI();
      updateEmployeesUI();
      updateFinancesUI();
      
      // Auto-save every 10 days
      if (currentDay % 10 === 0 && currentDay > 0) {
        saveGame();
      }
      
      // Check game over
      if (cash < 0) {
        pauseGame();
        logEvent("üíÄ GAME OVER! Company bankrupt!");
        showGameOver();
      }

      // Schedule next tick
      if (isPlaying) {
        tickTimer = setTimeout(gameTick, 1000 / gameSpeed);
      }
    }

    // ============================================
    // EMPLOYEE MANAGEMENT (Phase 3)
    // ============================================
    
    function generateEmployeeName() {
      const firstName = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
      const lastName = LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)];
      return `${firstName} ${lastName}`;
    }
    
    function getCurrentTeamSize() {
      return 1 + developers.length + marketers.length; // 1 for founder
    }
    
    function getOfficeCapacity() {
      return OFFICE_TIERS[currentOfficeTier].capacity;
    }
    
    function canHireMoreEmployees() {
      return getCurrentTeamSize() < getOfficeCapacity();
    }
    
    // ============================================
    // FINANCES CALCULATIONS
    // ============================================
    
    function calculateMonthlyIncome() {
      let totalRevenue = 0;
      let totalServerCost = 0;
      
      products.forEach(product => {
        if (product.status === 'published' || product.status === 'deprecated') {
          totalRevenue += product.subscribers * product.monthlyPrice;
          totalServerCost += product.subscribers * product.serverCostPerUser;
        }
      });
      
      return {
        grossRevenue: totalRevenue,
        serverCost: totalServerCost,
        netIncome: totalRevenue - totalServerCost
      };
    }
    
    function calculateMonthlyCosts() {
      const office = OFFICE_TIERS[currentOfficeTier];
      const teamSize = getCurrentTeamSize();
      
      const rent = currency === "USD" ? office.monthlyRentUSD : office.monthlyRentEUR;
      const utilitiesBase = currency === "USD" ? office.utilitiesBaseUSD : office.utilitiesBaseEUR;
      const utilitiesPerPerson = currency === "USD" ? office.utilitiesPerPersonUSD : office.utilitiesPerPersonEUR;
      const utilities = utilitiesBase + (utilitiesPerPerson * teamSize);
      
      // Insurance: 2% of gross revenue + base per employee
      const income = calculateMonthlyIncome();
      const insuranceBase = currency === "USD" ? 100 : 90;
      const insurance = (income.grossRevenue * 0.02) + (insuranceBase * (developers.length + marketers.length));
      
      // Salaries
      const salaries = [...developers, ...marketers].reduce((sum, emp) => sum + emp.monthlySalary, 0);
      
      // Server hosting fee (fixed monthly cost for tier)
      const server = SERVER_TIERS[currentServerTier];
      const serverFee = currency === "USD" ? server.monthlyFeeUSD : server.monthlyFeeEUR;
      
      return {
        rent: rent,
        utilities: utilities,
        insurance: insurance,
        salaries: salaries,
        serverFee: serverFee,
        total: rent + utilities + insurance + salaries + serverFee
      };
    }
    
    function calculateNetCashFlow() {
      const income = calculateMonthlyIncome();
      const costs = calculateMonthlyCosts();
      return income.netIncome - costs.total;
    }
    
    function calculateBurnRate() {
      const cashFlow = calculateNetCashFlow();
      if (cashFlow >= 0) return Infinity; // Profitable, no burn
      
      const monthlyBurn = Math.abs(cashFlow);
      if (monthlyBurn === 0) return Infinity;
      
      return Math.floor(cash / monthlyBurn);
    }
    
    function getTotalSubscribers() {
      return products.reduce((sum, p) => {
        if (p.status === 'published' || p.status === 'deprecated') {
          return sum + p.subscribers;
        }
        return sum;
      }, 0);
    }
    
    function getServerCapacityPercentage() {
      const server = SERVER_TIERS[currentServerTier];
      const totalSubs = getTotalSubscribers();
      return Math.min(100, Math.round((totalSubs / server.maxSubscribers) * 100));
    }
    
    function canUpgradeServer() {
      if (currentServerTier >= SERVER_TIERS.length - 1) return false;
      const nextTier = SERVER_TIERS[currentServerTier + 1];
      const cost = currency === "USD" ? nextTier.upgradeCostUSD : nextTier.upgradeCostEUR;
      return cash >= cost;
    }
    
    function upgradeServer() {
      if (!canUpgradeServer()) return;
      
      const nextTier = SERVER_TIERS[currentServerTier + 1];
      const cost = currency === "USD" ? nextTier.upgradeCostUSD : nextTier.upgradeCostEUR;
      
      cash -= cost;
      currentServerTier++;
      
      logEvent(`üñ•Ô∏è Server upgraded to ${nextTier.name}!`);
      logEvent(`  üìä Capacity: ${SERVER_TIERS[currentServerTier - 1].maxSubscribers} ‚Üí ${nextTier.maxSubscribers} subscribers`);
      logEvent(`  üí∞ Monthly Fee: ${formatCurrency(currency === "USD" ? SERVER_TIERS[currentServerTier - 1].monthlyFeeUSD : SERVER_TIERS[currentServerTier - 1].monthlyFeeEUR)} ‚Üí ${formatCurrency(currency === "USD" ? nextTier.monthlyFeeUSD : nextTier.monthlyFeeEUR)}/month`);
      logEvent(`  üî® Upgrade Cost Paid: ${formatCurrency(cost)}`);
      
      updateCashDisplay();
      updateFinancesUI();
    }
    
    function canDowngradeServer() {
      if (currentServerTier <= 0) return false;
      const prevTier = SERVER_TIERS[currentServerTier - 1];
      const totalSubs = getTotalSubscribers();
      return totalSubs <= prevTier.maxSubscribers;
    }
    
    function downgradeServer() {
      if (!canDowngradeServer()) {
        const prevTier = SERVER_TIERS[currentServerTier - 1];
        const totalSubs = getTotalSubscribers();
        alert(`‚ùå Cannot downgrade!\n\nYou have ${totalSubs.toLocaleString()} subscribers but ${prevTier.name} only supports ${prevTier.maxSubscribers.toLocaleString()}.\n\nReduce subscriber count first (wait for churn or deprecate products).`);
        return;
      }
      
      const currentTier = SERVER_TIERS[currentServerTier];
      const prevTier = SERVER_TIERS[currentServerTier - 1];
      const oldFee = currency === "USD" ? currentTier.monthlyFeeUSD : currentTier.monthlyFeeEUR;
      const newFee = currency === "USD" ? prevTier.monthlyFeeUSD : prevTier.monthlyFeeEUR;
      const savings = oldFee - newFee;
      
      // Show modal instead of confirm
      document.getElementById('downgradeServerName').textContent = `${currentTier.name} ‚Üí ${prevTier.name}`;
      document.getElementById('downgradeServerCapacity').textContent = `${currentTier.maxSubscribers.toLocaleString()} ‚Üí ${prevTier.maxSubscribers.toLocaleString()} subscribers`;
      document.getElementById('downgradeServerFee').textContent = `${formatCurrency(oldFee)} ‚Üí ${formatCurrency(newFee)}/month`;
      document.getElementById('downgradeServerSavings').textContent = `${formatCurrency(savings)}/mo`;
      document.getElementById('downgradeServerModal').classList.add('active');
    }
    
    function hideDowngradeServerModal() {
      document.getElementById('downgradeServerModal').classList.remove('active');
    }
    
    function confirmDowngradeServer() {
      const currentTier = SERVER_TIERS[currentServerTier];
      const prevTier = SERVER_TIERS[currentServerTier - 1];
      const oldFee = currency === "USD" ? currentTier.monthlyFeeUSD : currentTier.monthlyFeeEUR;
      const newFee = currency === "USD" ? prevTier.monthlyFeeUSD : prevTier.monthlyFeeEUR;
      const savings = oldFee - newFee;
      
      currentServerTier--;
      
      logEvent(`üìâ Server downgraded to ${prevTier.name}`);
      logEvent(`  üìä Capacity: ${currentTier.maxSubscribers.toLocaleString()} ‚Üí ${prevTier.maxSubscribers.toLocaleString()} subscribers`);
      logEvent(`  üí∞ Monthly Fee Reduced: ${formatCurrency(oldFee)} ‚Üí ${formatCurrency(newFee)}/month (saves ${formatCurrency(savings)}/mo)`);
      
      hideDowngradeServerModal();
      updateFinancesUI();
    }
    
    function hireDeveloper(tierIndex) {
      if (!canHireMoreEmployees()) {
        logEvent("‚ùå Office at capacity! Upgrade your office to hire more people.");
        return;
      }
      
      const tier = DEVELOPER_TIERS[tierIndex];
      const salary = currency === "USD" ? tier.monthlySalaryUSD : tier.monthlySalaryEUR;
      
      if (cash < salary) {
        logEvent(`‚ùå Not enough cash to hire ${tier.name}. Need ${formatCurrency(salary)}`);
        return;
      }
      
      const employee = {
        id: nextEmployeeId++,
        name: generateEmployeeName(),
        role: "developer",
        tier: tierIndex,
        tierName: tier.name,
        skill: tier.skill,
        efficiency: tier.efficiency,
        monthlySalary: salary,
        assignedProduct: null
      };
      
      developers.push(employee);
      cash -= salary; // Pay first month upfront
      
      logEvent(`‚úÖ Hired ${employee.name} as ${tier.name} for ${formatCurrency(salary)}/mo`);
      updateCashDisplay();
      updateEmployeesUI();
    }
    
    function hireMarketer(tierIndex) {
      if (!canHireMoreEmployees()) {
        logEvent("‚ùå Office at capacity! Upgrade your office to hire more people.");
        return;
      }
      
      const tier = MARKETER_TIERS[tierIndex];
      const salary = currency === "USD" ? tier.monthlySalaryUSD : tier.monthlySalaryEUR;
      
      if (cash < salary) {
        logEvent(`‚ùå Not enough cash to hire ${tier.name}. Need ${formatCurrency(salary)}`);
        return;
      }
      
      const employee = {
        id: nextEmployeeId++,
        name: generateEmployeeName(),
        role: "marketer",
        tier: tierIndex,
        tierName: tier.name,
        skill: tier.skill,
        efficiency: tier.efficiency,
        monthlySalary: salary,
        assignedProduct: null
      };
      
      marketers.push(employee);
      cash -= salary; // Pay first month upfront
      
      logEvent(`‚úÖ Hired ${employee.name} as ${tier.name} for ${formatCurrency(salary)}/mo`);
      updateCashDisplay();
      updateEmployeesUI();
    }
    
    function upgradeOffice() {
      if (currentOfficeTier >= OFFICE_TIERS.length - 1) {
        logEvent("‚ùå Already at maximum office tier!");
        return;
      }
      
      const currentTier = OFFICE_TIERS[currentOfficeTier];
      const nextTier = OFFICE_TIERS[currentOfficeTier + 1];
      const upgradeCost = currency === "USD" ? nextTier.monthlyRentUSD * 2 : nextTier.monthlyRentEUR * 2;
      const currentRent = currency === "USD" ? currentTier.monthlyRentUSD : currentTier.monthlyRentEUR;
      const nextRent = currency === "USD" ? nextTier.monthlyRentUSD : nextTier.monthlyRentEUR;
      
      if (cash < upgradeCost) {
        logEvent(`‚ùå Not enough cash to upgrade office. Need ${formatCurrency(upgradeCost)}`);
        return;
      }
      
      cash -= upgradeCost;
      currentOfficeTier++;
      
      logEvent(`üè¢ Upgraded to ${nextTier.name}!`);
      logEvent(`  üë• Capacity: ${currentTier.capacity} ‚Üí ${nextTier.capacity} people`);
      logEvent(`  üí∞ Monthly Rent: ${formatCurrency(currentRent)} ‚Üí ${formatCurrency(nextRent)}/mo`);
      logEvent(`  üî® Setup Cost Paid: ${formatCurrency(upgradeCost)}`);
      updateCashDisplay();
      updateEmployeesUI();
    }
    
    function canDowngradeOffice() {
      if (currentOfficeTier <= 0) return false;
      const prevTier = OFFICE_TIERS[currentOfficeTier - 1];
      const teamSize = getCurrentTeamSize();
      return teamSize <= prevTier.capacity;
    }
    
    function downgradeOffice() {
      if (!canDowngradeOffice()) {
        const prevTier = OFFICE_TIERS[currentOfficeTier - 1];
        const teamSize = getCurrentTeamSize();
        alert(`‚ùå Cannot downgrade!\n\nYou have ${teamSize} people but ${prevTier.name} only fits ${prevTier.capacity}.\n\nFire employees first to reduce team size.`);
        return;
      }
      
      const currentTier = OFFICE_TIERS[currentOfficeTier];
      const prevTier = OFFICE_TIERS[currentOfficeTier - 1];
      const oldRent = currency === "USD" ? currentTier.monthlyRentUSD : currentTier.monthlyRentEUR;
      const newRent = currency === "USD" ? prevTier.monthlyRentUSD : prevTier.monthlyRentEUR;
      const savings = oldRent - newRent;
      
      // Show modal instead of confirm
      document.getElementById('downgradeOfficeName').textContent = `${currentTier.name} ‚Üí ${prevTier.name}`;
      document.getElementById('downgradeOfficeCapacity').textContent = `${currentTier.capacity} ‚Üí ${prevTier.capacity} people`;
      document.getElementById('downgradeOfficeRent').textContent = `${formatCurrency(oldRent)} ‚Üí ${formatCurrency(newRent)}/month`;
      document.getElementById('downgradeOfficeSavings').textContent = `${formatCurrency(savings)}/mo`;
      document.getElementById('downgradeOfficeModal').classList.add('active');
    }
    
    function hideDowngradeOfficeModal() {
      document.getElementById('downgradeOfficeModal').classList.remove('active');
    }
    
    function confirmDowngradeOffice() {
      const currentTier = OFFICE_TIERS[currentOfficeTier];
      const prevTier = OFFICE_TIERS[currentOfficeTier - 1];
      const oldRent = currency === "USD" ? currentTier.monthlyRentUSD : currentTier.monthlyRentEUR;
      const newRent = currency === "USD" ? prevTier.monthlyRentUSD : prevTier.monthlyRentEUR;
      const savings = oldRent - newRent;
      
      currentOfficeTier--;
      
      logEvent(`üìâ Office downgraded to ${prevTier.name}`);
      logEvent(`  üë• Capacity: ${currentTier.capacity} ‚Üí ${prevTier.capacity} people`);
      logEvent(`  üí∞ Monthly Rent Reduced: ${formatCurrency(oldRent)} ‚Üí ${formatCurrency(newRent)}/month (saves ${formatCurrency(savings)}/mo)`);
      
      hideDowngradeOfficeModal();
      updateEmployeesUI();
    }
    
    let employeeToFire = null;
    
    function fireEmployee(employeeId) {
      const employee = [...developers, ...marketers].find(e => e.id === employeeId);
      if (!employee) return;
      
      const severancePay = employee.monthlySalary;
      
      if (cash < severancePay) {
        alert(`‚ùå Cannot afford severance pay!\n\nFiring ${employee.name} requires ${formatCurrency(severancePay)} in severance.\n\nCurrent cash: ${formatCurrency(cash)}`);
        return;
      }
      
      // Store employee ID for confirmation
      employeeToFire = employeeId;
      
      // Show modal instead of confirm
      document.getElementById('fireEmployeeName').textContent = `Fire ${employee.name}?`;
      document.getElementById('fireEmployeeRole').textContent = employee.tierName;
      document.getElementById('fireEmployeeSalary').textContent = `${formatCurrency(employee.monthlySalary)}/month`;
      document.getElementById('fireEmployeeSeverance').textContent = formatCurrency(severancePay);
      document.getElementById('fireEmployeeSavings').textContent = `${formatCurrency(employee.monthlySalary)}/mo`;
      document.getElementById('fireEmployeeCost').textContent = formatCurrency(severancePay);
      document.getElementById('fireEmployeeModal').classList.add('active');
    }
    
    function hideFireEmployeeModal() {
      document.getElementById('fireEmployeeModal').classList.remove('active');
      employeeToFire = null;
    }
    
    function confirmFireEmployee() {
      if (employeeToFire === null) return;
      
      const employee = [...developers, ...marketers].find(e => e.id === employeeToFire);
      if (!employee) {
        hideFireEmployeeModal();
        return;
      }
      
      const severancePay = employee.monthlySalary;
      
      // Pay severance
      cash -= severancePay;
      
      // Unassign from all products
      products.forEach(product => {
        if (employee.role === 'developer') {
          product.assignedDevelopers = product.assignedDevelopers.filter(id => id !== employeeToFire);
        } else {
          product.assignedMarketers = product.assignedMarketers.filter(id => id !== employeeToFire);
        }
      });
      
      // Remove from team
      if (employee.role === 'developer') {
        developers = developers.filter(d => d.id !== employeeToFire);
      } else {
        marketers = marketers.filter(m => m.id !== employeeToFire);
      }
      
      logEvent(`üî• Fired ${employee.name} (${employee.tierName})`);
      logEvent(`  üí∏ Severance Paid: ${formatCurrency(severancePay)}`);
      logEvent(`  üí∞ Monthly Savings: ${formatCurrency(employee.monthlySalary)}/month`);
      
      hideFireEmployeeModal();
      updateCashDisplay();
      updateEmployeesUI();
      updateProductsUI();
    }
    
    function updateEmployeesUI() {
      // Update office info
      const office = OFFICE_TIERS[currentOfficeTier];
      const teamSize = getCurrentTeamSize();
      const officeInfo = document.getElementById('officeInfo');
      
      const rent = currency === "USD" ? office.monthlyRentUSD : office.monthlyRentEUR;
      
      // Calculate upgrade/downgrade details
      let upgradeSection = '';
      const canUpgradeOffice = currentOfficeTier < OFFICE_TIERS.length - 1;
      const canDowngrade = canDowngradeOffice();
      
      if (canUpgradeOffice || canDowngrade) {
        upgradeSection = '<div class="office-upgrade-section"><div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">';
        
        // Upgrade column
        if (canUpgradeOffice) {
          const nextTier = OFFICE_TIERS[currentOfficeTier + 1];
          const setupCost = currency === "USD" ? nextTier.monthlyRentUSD * 2 : nextTier.monthlyRentEUR * 2;
          const nextRent = currency === "USD" ? nextTier.monthlyRentUSD : nextTier.monthlyRentEUR;
          const canAfford = canAffordOfficeUpgrade();
          
          upgradeSection += `
            <div style="flex: 1; display: flex; flex-direction: column;">
              <button 
                class="office-upgrade-btn" 
                onclick="upgradeOffice()"
                ${!canAfford ? 'disabled' : ''}
                style="margin-bottom: 0.35rem;"
              >
                ‚¨ÜÔ∏è ${nextTier.name}
              </button>
              <div class="office-upgrade-details" style="font-size: 0.75rem; padding: 0.5rem;">
                <div style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.75rem;">‚¨ÜÔ∏è Upgrade:</div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üë• ${office.capacity} ‚Üí</span>
                  <span><strong>${nextTier.capacity}</strong> people</span>
                </div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üí∞ ${formatCurrency(rent)} ‚Üí</span>
                  <span><strong>${formatCurrency(nextRent)}</strong>/mo</span>
                </div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üî® Setup:</span>
                  <span><strong>${formatCurrency(setupCost)}</strong></span>
                </div>
              </div>
            </div>
          `;
        }
        
        // Downgrade column
        if (canDowngrade) {
          const prevTier = OFFICE_TIERS[currentOfficeTier - 1];
          const prevRent = currency === "USD" ? prevTier.monthlyRentUSD : prevTier.monthlyRentEUR;
          const savings = rent - prevRent;
          
          upgradeSection += `
            <div style="flex: 1; display: flex; flex-direction: column;">
              <button 
                class="office-upgrade-btn" 
                onclick="downgradeOffice()"
                style="background: #6b7280; margin-bottom: 0.35rem;"
              >
                ‚¨áÔ∏è ${prevTier.name}
              </button>
              <div class="office-upgrade-details" style="background: #f3f4f6; font-size: 0.75rem; padding: 0.5rem;">
                <div style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.75rem;">‚¨áÔ∏è Downgrade:</div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üë• ${office.capacity} ‚Üí</span>
                  <span><strong>${prevTier.capacity}</strong> people</span>
                </div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üí∞ Save:</span>
                  <span><strong>${formatCurrency(savings)}</strong>/mo</span>
                </div>
                <div class="upgrade-detail" style="color: #10b981; font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>‚úÖ No cost</span>
                  <span></span>
                </div>
              </div>
            </div>
          `;
        }
        
        upgradeSection += '</div></div>';
      } else if (currentOfficeTier >= OFFICE_TIERS.length - 1) {
        upgradeSection = '<div style="text-align: center; color: #6b7280; font-size: 0.9rem;">üèÜ Maximum office tier!</div>';
      }
      
      officeInfo.innerHTML = `
        <div class="office-name">üè¢ ${office.name}</div>
        <div class="office-stats">
          <span>üë• ${teamSize} / ${office.capacity} people</span>
          ${rent > 0 ? `<span>üí∞ ${formatCurrency(rent)}/mo rent</span>` : '<span>üè† No rent (working from home!)</span>'}
        </div>
        ${upgradeSection}
      `;
      
      // Update employee list
      const employeeList = document.getElementById('employeeList');
      
      if (developers.length === 0 && marketers.length === 0) {
        employeeList.innerHTML = '<div class="empty-state">No employees yet. Hire your first team member!</div>';
        return;
      }
      
      employeeList.innerHTML = [...developers, ...marketers].map(emp => {
        // Find which product this employee is assigned to
        const assignment = products.find(p => {
          if (emp.role === 'developer') {
            return p.assignedDevelopers.includes(emp.id);
          } else {
            return p.assignedMarketers.includes(emp.id);
          }
        });
        
        return `
          <div class="employee-card">
            <div class="employee-header">
              <div>
                <div class="employee-name">${emp.name}</div>
                <div class="employee-role role-${emp.role}">
                  ${emp.role === 'developer' ? 'üë®‚Äçüíª' : 'üì¢'} ${emp.tierName}
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span class="skill-badge skill-${emp.skill}">${emp.skill}</span>
                <button 
                  class="btn" 
                  onclick="fireEmployee(${emp.id})"
                  style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: #ef4444; border-color: #dc2626;"
                  title="Fire employee (1 month severance)"
                >
                  üî• Fire
                </button>
              </div>
            </div>
            <div class="employee-stats">
              <div class="employee-stat">‚ö° Efficiency: ${emp.efficiency}x</div>
              <div class="employee-stat">üí∞ Salary: ${formatCurrency(emp.monthlySalary)}/mo</div>
            </div>
            <div class="employee-assignment ${assignment ? 'assignment-active' : ''}">
              ${assignment ? 
                `üìå Working on: ${assignment.name}` : 
                'üí§ Unassigned (assign to a product)'
              }
            </div>
          </div>
        `;
      }).join('');
    }
    
    function updateFinancesUI() {
      const financesContent = document.getElementById('financesContent');
      
      const income = calculateMonthlyIncome();
      const costs = calculateMonthlyCosts();
      const cashFlow = calculateNetCashFlow();
      const burnRate = calculateBurnRate();
      
      const totalSubs = getTotalSubscribers();
      const server = SERVER_TIERS[currentServerTier];
      const capacityPercent = getServerCapacityPercentage();
      
      // Calculate days until next billing
      const daysUntilBilling = currentDay === 0 ? 30 : (30 - (currentDay % 30));
      
      // Server upgrade/downgrade section
      let serverUpgradeSection = '';
      const canUpgrade = currentServerTier < SERVER_TIERS.length - 1;
      const canDowngrade = canDowngradeServer();
      
      if (canUpgrade || canDowngrade) {
        serverUpgradeSection = '<div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">';
        
        // Upgrade column
        if (canUpgrade) {
          const nextTier = SERVER_TIERS[currentServerTier + 1];
          const upgradeCost = currency === "USD" ? nextTier.upgradeCostUSD : nextTier.upgradeCostEUR;
          const nextFee = currency === "USD" ? nextTier.monthlyFeeUSD : nextTier.monthlyFeeEUR;
          const canAfford = canUpgradeServer();
          
          serverUpgradeSection += `
            <div style="flex: 1; display: flex; flex-direction: column;">
              <button 
                class="office-upgrade-btn" 
                onclick="upgradeServer()"
                ${!canAfford ? 'disabled' : ''}
                style="margin-bottom: 0.35rem;"
              >
                ‚¨ÜÔ∏è ${nextTier.name}
              </button>
              <div class="office-upgrade-details" style="padding: 0.5rem; font-size: 0.75rem;">
                <div style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.75rem;">‚¨ÜÔ∏è Upgrade:</div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üìä ${server.maxSubscribers.toLocaleString()} ‚Üí</span>
                  <span><strong>${nextTier.maxSubscribers.toLocaleString()}</strong> subs</span>
                </div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üí∞ ${formatCurrency(costs.serverFee)} ‚Üí</span>
                  <span><strong>${formatCurrency(nextFee)}</strong>/mo</span>
                </div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üî® Setup:</span>
                  <span><strong>${formatCurrency(upgradeCost)}</strong></span>
                </div>
              </div>
            </div>
          `;
        }
        
        // Downgrade column
        if (canDowngrade) {
          const prevTier = SERVER_TIERS[currentServerTier - 1];
          const prevFee = currency === "USD" ? prevTier.monthlyFeeUSD : prevTier.monthlyFeeEUR;
          const savings = costs.serverFee - prevFee;
          
          serverUpgradeSection += `
            <div style="flex: 1; display: flex; flex-direction: column;">
              <button 
                class="office-upgrade-btn" 
                onclick="downgradeServer()"
                style="background: #6b7280; margin-bottom: 0.35rem;"
              >
                ‚¨áÔ∏è ${prevTier.name}
              </button>
              <div class="office-upgrade-details" style="padding: 0.5rem; font-size: 0.75rem; background: #f3f4f6;">
                <div style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.75rem;">‚¨áÔ∏è Downgrade:</div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üìä ${server.maxSubscribers.toLocaleString()} ‚Üí</span>
                  <span><strong>${prevTier.maxSubscribers.toLocaleString()}</strong> subs</span>
                </div>
                <div class="upgrade-detail" style="font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>üí∞ Save:</span>
                  <span><strong>${formatCurrency(savings)}</strong>/mo</span>
                </div>
                <div class="upgrade-detail" style="color: #10b981; font-size: 0.7rem; padding: 0.15rem 0;">
                  <span>‚úÖ No cost</span>
                  <span></span>
                </div>
              </div>
            </div>
          `;
        }
        
        serverUpgradeSection += '</div>';
      } else if (currentServerTier >= SERVER_TIERS.length - 1) {
        serverUpgradeSection = '<div style="text-align: center; color: #6b7280; font-size: 0.75rem; margin-top: 0.35rem;">üèÜ Maximum server tier!</div>';
      }
      
      // Capacity warning
      let capacityWarning = '';
      if (capacityPercent >= 90) {
        capacityWarning = '<div style="color: #ef4444; font-size: 0.75rem; margin-top: 0.35rem;">‚ö†Ô∏è Server capacity critical! Upgrade soon!</div>';
      } else if (capacityPercent >= 75) {
        capacityWarning = '<div style="color: #f59e0b; font-size: 0.75rem; margin-top: 0.35rem;">‚ö†Ô∏è Server capacity high. Consider upgrading.</div>';
      }
      
      financesContent.innerHTML = `
        <!-- Financial Summary -->
        <div class="finance-card">
          <div class="finance-header">üí∞ Monthly Finances</div>
          <div style="text-align: center; padding: 0.35rem; background: #f9fafb; border-radius: 4px; margin-bottom: 0.5rem;">
            <div style="font-size: 0.75rem; color: #6b7280;">üìÖ Next Billing Cycle</div>
            <div style="font-size: 0.85rem; font-weight: 600; color: #111827; margin-top: 0.15rem;">In ${daysUntilBilling} ${daysUntilBilling === 1 ? 'day' : 'days'}</div>
          </div>
          <div class="finance-row">
            <span>üìà Income:</span>
            <span class="finance-value positive">${formatCurrency(income.netIncome)}</span>
          </div>
          <div class="finance-row-sub">
            Revenue: ${formatCurrency(income.grossRevenue)} - Server Cost: ${formatCurrency(income.serverCost)}
          </div>
          <div class="finance-row" style="margin-top: 0.5rem;">
            <span>üìâ Expenses:</span>
            <span class="finance-value negative">${formatCurrency(costs.total)}</span>
          </div>
          <div class="finance-row-sub">
            ${costs.rent > 0 ? `Rent: ${formatCurrency(costs.rent)}, ` : ''}Utilities: ${formatCurrency(costs.utilities)}, Insurance: ${formatCurrency(costs.insurance)}${costs.salaries > 0 ? `, Salaries: ${formatCurrency(costs.salaries)}` : ''}${costs.serverFee > 0 ? `, Server: ${formatCurrency(costs.serverFee)}` : ''}
          </div>
          <div class="finance-divider"></div>
          <div class="finance-row">
            <span>üíµ Net Cash Flow:</span>
            <span class="finance-value ${cashFlow >= 0 ? 'positive' : 'negative'}">${formatCurrency(cashFlow)}</span>
          </div>
          <div class="finance-row" style="margin-top: 0.5rem;">
            <span>‚è±Ô∏è Burn Rate:</span>
            <span class="finance-value ${burnRate === Infinity ? 'positive' : (burnRate <= 3 ? 'negative' : 'neutral')}">
              ${burnRate === Infinity ? '‚àû (Profitable!)' : `${burnRate} ${burnRate === 1 ? 'month' : 'months'}`}
            </span>
          </div>
        </div>
        
        <!-- Server Tier -->
        <div class="finance-card" style="margin-top: 0.75rem;">
          <div class="finance-header">üñ•Ô∏è ${server.name}</div>
          <div class="server-capacity">
            <div class="capacity-label">
              <span>üìä Capacity:</span>
              <span>${totalSubs.toLocaleString()} / ${server.maxSubscribers.toLocaleString()} subscribers</span>
            </div>
            <div class="capacity-bar">
              <div class="capacity-fill ${capacityPercent >= 90 ? 'capacity-critical' : (capacityPercent >= 75 ? 'capacity-warning' : '')}" style="width: ${capacityPercent}%"></div>
            </div>
            <div class="capacity-percent">${capacityPercent}%</div>
          </div>
          ${capacityWarning}
          ${serverUpgradeSection}
        </div>
      `;
    }
    
    function showHireDeveloperModal() {
      const modal = document.getElementById('hireDeveloperModal');
      const list = document.getElementById('hireDeveloperList');
      
      list.innerHTML = DEVELOPER_TIERS.map((tier, index) => {
        const salary = currency === "USD" ? tier.monthlySalaryUSD : tier.monthlySalaryEUR;
        const canAfford = cash >= salary;
        const hasCapacity = canHireMoreEmployees();
        
        return `
          <button 
            class="hire-btn" 
            onclick="hireDeveloper(${index}); hideHireDeveloperModal();"
            ${!canAfford || !hasCapacity ? 'disabled' : ''}
            style="width: 100%; margin-bottom: 0.75rem;"
          >
            <div class="hire-btn-info">
              <div class="hire-btn-title">
                <span class="skill-badge skill-${tier.skill}">${tier.name}</span>
              </div>
              <div class="hire-btn-stats">‚ö° ${tier.efficiency}x efficiency ‚Ä¢ üíº ${formatCurrency(salary)}/mo</div>
            </div>
            <div class="hire-btn-cost">${formatCurrency(salary)}</div>
          </button>
        `;
      }).join('');
      
      modal.classList.add('active');
    }
    
    function hideHireDeveloperModal() {
      document.getElementById('hireDeveloperModal').classList.remove('active');
    }
    
    function showHireMarketerModal() {
      const modal = document.getElementById('hireMarketerModal');
      const list = document.getElementById('hireMarketerList');
      
      list.innerHTML = MARKETER_TIERS.map((tier, index) => {
        const salary = currency === "USD" ? tier.monthlySalaryUSD : tier.monthlySalaryEUR;
        const canAfford = cash >= salary;
        const hasCapacity = canHireMoreEmployees();
        
        return `
          <button 
            class="hire-btn" 
            onclick="hireMarketer(${index}); hideHireMarketerModal();"
            ${!canAfford || !hasCapacity ? 'disabled' : ''}
            style="width: 100%; margin-bottom: 0.75rem;"
          >
            <div class="hire-btn-info">
              <div class="hire-btn-title">
                <span class="skill-badge skill-${tier.skill}">${tier.name}</span>
              </div>
              <div class="hire-btn-stats">‚ö° ${tier.efficiency}x efficiency ‚Ä¢ üíº ${formatCurrency(salary)}/mo</div>
            </div>
            <div class="hire-btn-cost">${formatCurrency(salary)}</div>
          </button>
        `;
      }).join('');
      
      modal.classList.add('active');
    }
    
    function hideHireMarketerModal() {
      document.getElementById('hireMarketerModal').classList.remove('active');
    }
    
    // ============================================
    // ASSIGN DEVELOPER/MARKETER TO PRODUCT MODALS
    // ============================================
    
    let currentAssignProductId = null;
    
    function showAssignDeveloperModal(productId) {
      currentAssignProductId = productId;
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      const modal = document.getElementById('assignDeveloperModal');
      const list = document.getElementById('assignDeveloperList');
      const productNameEl = document.getElementById('assignDeveloperProductName');
      
      productNameEl.textContent = `Select a developer to assign to "${product.name}"`;
      
      // Get available developers (not assigned to ANY product)
      const availableDevelopers = [];
      
      // Founder (only show if not assigned to any product)
      if (founder.assignedProduct === null) {
        availableDevelopers.push({
          id: 'founder',
          name: founder.name,
          role: 'Founder',
          efficiency: founder.efficiency,
          isFounder: true
        });
      }
      
      // Hired developers (only show if not assigned to ANY product)
      developers.forEach(dev => {
        const isAssignedAnywhere = products.some(p => p.assignedDevelopers.includes(dev.id));
        if (!isAssignedAnywhere) {
          availableDevelopers.push({
            id: dev.id,
            name: dev.name,
            role: dev.tierName,
            efficiency: dev.efficiency,
            isFounder: false
          });
        }
      });
      
      if (availableDevelopers.length === 0) {
        list.innerHTML = '<div class="empty-state">No available developers. All developers are currently assigned to other products. Unassign them first to reassign.</div>';
      } else {
        list.innerHTML = availableDevelopers.map(dev => `
          <button 
            class="hire-btn" 
            onclick="${dev.isFounder ? 'assignFounderToProduct' : 'assignEmployeeToProduct'}(${dev.isFounder ? productId : dev.id + ',' + productId}); hideAssignDeveloperModal();"
          >
            <div class="hire-btn-header">
              <span class="hire-btn-title">üë®‚Äçüíª ${dev.name}</span>
              <span class="hire-btn-role">${dev.role}</span>
            </div>
            <div class="hire-btn-details">
              <span>‚ö° Efficiency: ${Math.round(dev.efficiency * 100)}%</span>
            </div>
          </button>
        `).join('');
      }
      
      modal.classList.add('active');
    }
    
    function hideAssignDeveloperModal() {
      document.getElementById('assignDeveloperModal').classList.remove('active');
      currentAssignProductId = null;
    }
    
    function showAssignMarketerModal(productId) {
      currentAssignProductId = productId;
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      const modal = document.getElementById('assignMarketerModal');
      const list = document.getElementById('assignMarketerList');
      const productNameEl = document.getElementById('assignMarketerProductName');
      
      productNameEl.textContent = `Select a marketer to assign to "${product.name}"`;
      
      // Get available marketers (not assigned to ANY product)
      const availableMarketers = [];
      
      // Founder (only show if not assigned to any product)
      if (founder.assignedProduct === null) {
        availableMarketers.push({
          id: 'founder',
          name: founder.name,
          role: 'Founder',
          efficiency: founder.efficiency,
          isFounder: true
        });
      }
      
      // Hired marketers (only show if not assigned to ANY product)
      marketers.forEach(mkt => {
        const isAssignedAnywhere = products.some(p => p.assignedMarketers.includes(mkt.id));
        if (!isAssignedAnywhere) {
          availableMarketers.push({
            id: mkt.id,
            name: mkt.name,
            role: mkt.tierName,
            efficiency: mkt.efficiency,
            isFounder: false
          });
        }
      });
      
      if (availableMarketers.length === 0) {
        list.innerHTML = '<div class="empty-state">No available marketers. All marketers are currently assigned to other products. Unassign them first to reassign.</div>';
      } else {
        list.innerHTML = availableMarketers.map(mkt => `
          <button 
            class="hire-btn" 
            onclick="${mkt.isFounder ? 'assignFounderToProductAsMarketer' : 'assignEmployeeToProduct'}(${mkt.isFounder ? productId : mkt.id + ',' + productId}); hideAssignMarketerModal();"
          >
            <div class="hire-btn-header">
              <span class="hire-btn-title">üì¢ ${mkt.name}</span>
              <span class="hire-btn-role">${mkt.role}</span>
            </div>
            <div class="hire-btn-details">
              <span>‚ö° Efficiency: ${Math.round(mkt.efficiency * 100)}%</span>
            </div>
          </button>
        `).join('');
      }
      
      modal.classList.add('active');
    }
    
    function hideAssignMarketerModal() {
      document.getElementById('assignMarketerModal').classList.remove('active');
      currentAssignProductId = null;
    }
    
    function canAffordOfficeUpgrade() {
      if (currentOfficeTier >= OFFICE_TIERS.length - 1) return false;
      const nextTier = OFFICE_TIERS[currentOfficeTier + 1];
      const cost = currency === "USD" ? nextTier.monthlyRentUSD * 2 : nextTier.monthlyRentEUR * 2;
      return cash >= cost;
    }
    
    function handleMonthlyBilling() {
      const month = Math.floor(currentDay / 30);
      logEvent(`üìÖ Month ${month} completed - Processing monthly billing...`);
      
      // ============================================
      // REVENUE COLLECTION
      // ============================================
      
      // Calculate monthly revenue from all products (published and deprecated)
      let totalRevenue = 0;
      let totalServerCost = 0;
      
      products.forEach(product => {
        if (product.status === 'published' || product.status === 'deprecated') {
          const productRevenue = product.subscribers * product.monthlyPrice;
          const productServerCost = product.subscribers * product.serverCostPerUser;
          totalRevenue += productRevenue;
          totalServerCost += productServerCost;
        }
      });
      
      const netRevenue = totalRevenue - totalServerCost;
      cash += netRevenue;
      
      // ============================================
      // EXPENSE PAYMENTS
      // ============================================
      
      // Calculate office costs
      const office = OFFICE_TIERS[currentOfficeTier];
      const teamSize = getCurrentTeamSize();
      
      const rent = currency === "USD" ? office.monthlyRentUSD : office.monthlyRentEUR;
      const utilitiesBase = currency === "USD" ? office.utilitiesBaseUSD : office.utilitiesBaseEUR;
      const utilitiesPerPerson = currency === "USD" ? office.utilitiesPerPersonUSD : office.utilitiesPerPersonEUR;
      const utilities = utilitiesBase + (utilitiesPerPerson * teamSize);
      
      // Calculate insurance (2% of gross revenue + base per employee)
      const insuranceBase = currency === "USD" ? 100 : 90;
      const insurance = (totalRevenue * 0.02) + (insuranceBase * (developers.length + marketers.length));
      
      // Calculate total salaries
      const salaries = [...developers, ...marketers].reduce((sum, emp) => sum + emp.monthlySalary, 0);
      
      // Calculate server hosting fee
      const server = SERVER_TIERS[currentServerTier];
      const serverFee = currency === "USD" ? server.monthlyFeeUSD : server.monthlyFeeEUR;
      
      // Deduct costs
      const totalCosts = rent + utilities + insurance + salaries + serverFee;
      cash -= totalCosts;
      
      // ============================================
      // CONSOLIDATED LOGGING
      // ============================================
      
      // Log revenue (consolidated)
      if (totalRevenue > 0) {
        const revenueBreakdown = [];
        if (totalRevenue > 0) revenueBreakdown.push(`Revenue: ${formatCurrency(totalRevenue)}`);
        if (totalServerCost > 0) revenueBreakdown.push(`Server Cost: ${formatCurrency(totalServerCost)}`);
        
        logEvent(`üíµ Monthly Income: ${formatCurrency(netRevenue)} (${revenueBreakdown.join(', ')})`);
      }
      
      // Log expenses (consolidated)
      const expenseBreakdown = [];
      if (rent > 0) expenseBreakdown.push(`Rent: ${formatCurrency(rent)}`);
      expenseBreakdown.push(`Utilities: ${formatCurrency(utilities)}`);
      if (insurance > 0) expenseBreakdown.push(`Insurance: ${formatCurrency(insurance)}`);
      if (salaries > 0) expenseBreakdown.push(`Salaries: ${formatCurrency(salaries)}`);
      if (serverFee > 0) expenseBreakdown.push(`Server: ${formatCurrency(serverFee)}`);
      
      logEvent(`üí∞ Monthly Expenses: ${formatCurrency(totalCosts)} (${expenseBreakdown.join(', ')})`);
      
      // Log net result
      const netResult = netRevenue - totalCosts;
      if (netResult >= 0) {
        logEvent(`‚úÖ Net Profit: ${formatCurrency(netResult)}`);
      } else {
        logEvent(`‚ö†Ô∏è Net Loss: ${formatCurrency(Math.abs(netResult))}`);
      }
      
      updateCashDisplay();
    }

    // ============================================
    // NEW GAME SETUP
    // ============================================
    
    function generateRandomCompanyName() {
      const prefix = COMPANY_PREFIXES[Math.floor(Math.random() * COMPANY_PREFIXES.length)];
      const suffix = COMPANY_SUFFIXES[Math.floor(Math.random() * COMPANY_SUFFIXES.length)];
      return `${prefix} ${suffix}`;
    }
    
    function generateRandomFounderName() {
      const firstName = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
      const lastName = LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)];
      return `${firstName} ${lastName}`;
    }
    
    function populateNewGameForm() {
      document.getElementById('companyNameInput').value = generateRandomCompanyName();
      document.getElementById('founderNameInput').value = generateRandomFounderName();
    }
    
    function showGameOver() {
      // Update game over modal with final stats
      document.getElementById('gameOverDays').textContent = currentDay + ' days';
      document.getElementById('gameOverProducts').textContent = products.length;
      document.getElementById('gameOverTeam').textContent = getCurrentTeamSize();
      document.getElementById('gameOverCash').textContent = formatCurrency(cash);
      
      // Show modal
      document.getElementById('gameOverModal').classList.add('active');
    }
    
    function restartGame() {
      // Hide game over modal
      document.getElementById('gameOverModal').classList.remove('active');
      
      // Show new game setup modal
      document.getElementById('newGameModal').classList.add('active');
      
      // Populate form with random names
      populateNewGameForm();
    }
    
    // ============================================
    // SAVE/LOAD SYSTEM
    // ============================================
    
    function saveGame() {
      const saveData = {
        version: "2.0",
        timestamp: Date.now(),
        gameState: {
          // Game config
          currency: currency,
          currentDay: currentDay,
          cash: cash,
          companyName: companyName,
          isPlaying: isPlaying,
          gameSpeed: gameSpeed,
          
          // Founder
          founder: {
            name: founder.name,
            efficiency: founder.efficiency,
            skillLevel: founder.skillLevel,
            experiencePoints: founder.experiencePoints,
            assignedProduct: founder.assignedProduct
          },
          
          // Infrastructure
          currentOfficeTier: currentOfficeTier,
          currentServerTier: currentServerTier,
          
          // Entities
          products: products,
          developers: developers,
          marketers: marketers,
          
          // IDs
          nextProductId: nextProductId,
          nextEmployeeId: nextEmployeeId,
          
          // Event log (keep last 50 events)
          eventLog: eventLog.slice(-50)
        }
      };
      
      try {
        localStorage.setItem('softwareCompanyGame', JSON.stringify(saveData));
        logEvent("üíæ Game saved!");
        
        return true;
      } catch (e) {
        logEvent("‚ùå Failed to save game: " + e.message);
        alert("Failed to save game. Your browser might have storage disabled.");
        return false;
      }
    }
    
    function loadGame() {
      try {
        const savedData = localStorage.getItem('softwareCompanyGame');
        if (!savedData) {
          return false; // No save found
        }
        
        const save = JSON.parse(savedData);
        
        // Validate save version
        if (!save.version || !save.gameState) {
          console.error("Invalid save format");
          return false;
        }
        
        // Restore game state
        currency = save.gameState.currency;
        currentDay = save.gameState.currentDay;
        cash = save.gameState.cash;
        companyName = save.gameState.companyName;
        isPlaying = save.gameState.isPlaying || false;
        gameSpeed = save.gameState.gameSpeed || 1;
        
        // Restore founder
        founder.name = save.gameState.founder.name;
        founder.efficiency = save.gameState.founder.efficiency;
        founder.skillLevel = save.gameState.founder.skillLevel;
        founder.experiencePoints = save.gameState.founder.experiencePoints;
        founder.assignedProduct = save.gameState.founder.assignedProduct;
        
        // Restore infrastructure
        currentOfficeTier = save.gameState.currentOfficeTier || 0;
        currentServerTier = save.gameState.currentServerTier || 0;
        
        // Restore entities
        products = save.gameState.products || [];
        developers = save.gameState.developers || [];
        marketers = save.gameState.marketers || [];
        
        // Restore IDs
        nextProductId = save.gameState.nextProductId || 1;
        nextEmployeeId = save.gameState.nextEmployeeId || 1;
        
        // Restore event log
        eventLog = save.gameState.eventLog || [];
        
        // Update UI
        document.getElementById('companyNameDisplay').textContent = companyName;
        updateCashDisplay();
        updateDayDisplay();
        updateFounderDisplay();
        updateProductsUI();
        updateEmployeesUI();
        updateFinancesUI();
        updateEventLog();
        updateSpeedButtons();
        
        // Show pause banner if game was paused
        if (!isPlaying) {
          document.getElementById('pauseBanner').classList.add('active');
        }
        
        logEvent("üìÇ Game loaded successfully!");
        
        const saveDate = new Date(save.timestamp);
        logEvent(`üíæ Last saved: ${saveDate.toLocaleString()}`);
        
        return true;
      } catch (e) {
        console.error("Failed to load game:", e);
        logEvent("‚ùå Failed to load saved game");
        return false;
      }
    }
    
    function resetGameWithConfirmation() {
      // Pause game first
      pauseGame();
      
      // Confirm reset
      const message = "üîÑ Reset Game?\n\nThis will delete your current progress and start a new game.\n\nCurrent Progress:\n" +
                     "‚Ä¢ Day " + currentDay + "\n" +
                     "‚Ä¢ Cash: " + formatCurrency(cash) + "\n" +
                     "‚Ä¢ Products: " + products.length + "\n" +
                     "‚Ä¢ Team: " + getCurrentTeamSize() + " people\n\n" +
                     "Are you sure?";
      
      if (confirm(message)) {
        // Clear save
        try {
          localStorage.removeItem('softwareCompanyGame');
        } catch (e) {
          console.error("Failed to clear save:", e);
        }
        
        // Show new game modal
        document.getElementById('newGameModal').classList.add('active');
        populateNewGameForm();
        
        logEvent("üîÑ Game reset. Starting fresh...");
      } else {
        // User cancelled, resume if it was playing
        logEvent("‚ùå Reset cancelled");
      }
    }
    
    function initNewGame() {
      const form = document.getElementById('newGameForm');
      const companyNameInput = document.getElementById('companyNameInput');
      const founderNameInput = document.getElementById('founderNameInput');
      const selectedCurrency = document.querySelector('input[name="currency"]:checked').value;
      const selectedCapital = parseInt(document.querySelector('input[name="capital"]:checked').value);

      // Set game state
      companyName = companyNameInput.value || "My Startup";
      founder.name = founderNameInput.value || "Founder";
      founder.efficiency = 1.0;
      founder.skillLevel = 1;
      founder.experiencePoints = 0;
      founder.assignedProduct = null;
      currency = selectedCurrency;
      cash = selectedCapital;
      currentDay = 0;

      // Update UI
      document.getElementById('companyNameDisplay').textContent = companyName;
      updateCashDisplay();
      updateDayDisplay();
      updateFounderDisplay();

      // Reset game state
      products = [];
      developers = [];
      marketers = [];
      nextEmployeeId = 1;
      nextProductId = 1;
      currentOfficeTier = 0; // Start with Home Office
      currentServerTier = 0; // Start with Shared Hosting (free)
      eventLog = [];
      
      // Log start
      logEvent(`üéâ ${companyName} founded by ${founder.name}!`);
      logEvent(`üí∞ Starting with ${formatCurrency(cash)}`);
      logEvent(`üè¢ Working from ${OFFICE_TIERS[0].name} (capacity: ${OFFICE_TIERS[0].capacity})`);
      logEvent(`üñ•Ô∏è Server: ${SERVER_TIERS[0].name} (free tier)`);
      
      // Initialize UI
      updateFounderDisplay();
      updateProductsUI();
      updateEmployeesUI();
      updateFinancesUI();

      // Close modal
      document.getElementById('newGameModal').classList.remove('active');

      // Start game paused
      isPlaying = false;
      updateSpeedButtons();
      document.getElementById('pauseBanner').classList.add('active');
      logEvent(`‚è∏Ô∏è Game paused. Press Space or click Play to start!`);
      
      // Save initial game state
      saveGame();
    }

    // Make functions globally accessible for onclick handlers
    window.assignFounderToProduct = assignFounderToProduct;
    window.assignFounderToProductAsMarketer = assignFounderToProductAsMarketer;
    window.unassignFounderFromProduct = unassignFounderFromProduct;
    window.assignEmployeeToProduct = assignEmployeeToProduct;
    window.unassignEmployeeFromProduct = unassignEmployeeFromProduct;
    window.hireDeveloper = hireDeveloper;
    window.hireMarketer = hireMarketer;
    window.upgradeOffice = upgradeOffice;
    window.upgradeServer = upgradeServer;
    window.showHireDeveloperModal = showHireDeveloperModal;
    window.hideHireDeveloperModal = hideHireDeveloperModal;
    window.showHireMarketerModal = showHireMarketerModal;
    window.hideHireMarketerModal = hideHireMarketerModal;
    window.showAssignDeveloperModal = showAssignDeveloperModal;
    window.hideAssignDeveloperModal = hideAssignDeveloperModal;
    window.showAssignMarketerModal = showAssignMarketerModal;
    window.hideAssignMarketerModal = hideAssignMarketerModal;
    window.generateRandomCompanyName = generateRandomCompanyName;
    window.generateRandomFounderName = generateRandomFounderName;
    window.restartGame = restartGame;

    // ============================================
    // EVENT LISTENERS
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      // Try to load existing save
      const saveLoaded = loadGame();
      
      if (saveLoaded) {
        // Hide new game modal if save was loaded
        document.getElementById('newGameModal').classList.remove('active');
        logEvent("üéÆ Welcome back to " + companyName + "!");
      } else {
        // No save found, show new game modal with random names
        populateNewGameForm();
      }
      
      // Speed controls
      document.getElementById('pauseBtn').addEventListener('click', () => pauseGame());
      document.getElementById('playBtn').addEventListener('click', () => { setGameSpeed(1); startGame(); });
      document.getElementById('speed2xBtn').addEventListener('click', () => { setGameSpeed(2); startGame(); });
      document.getElementById('speed5xBtn').addEventListener('click', () => { setGameSpeed(5); startGame(); });

      // Game controls
      document.getElementById('saveBtn').addEventListener('click', () => saveGame());
      document.getElementById('resetBtn').addEventListener('click', () => resetGameWithConfirmation());

      // New game setup
      document.getElementById('startGameBtn').addEventListener('click', () => initNewGame());

      // Phase 2: Product system
      document.getElementById('newProductBtn').addEventListener('click', () => showNewProductModal());
      document.getElementById('cancelProductBtn').addEventListener('click', () => hideNewProductModal());
      document.getElementById('createProductBtn').addEventListener('click', () => handleCreateProduct());
      
      // Keyboard controls
      document.addEventListener('keydown', (event) => {
        // Spacebar to play/pause
        if (event.code === 'Space' || event.key === ' ') {
          // Don't trigger if user is typing in an input field or modal is open
          const newGameModal = document.getElementById('newGameModal');
          const activeElement = document.activeElement;
          const isTyping = activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA';
          const isModalOpen = newGameModal.classList.contains('active');
          
          if (!isTyping && !isModalOpen) {
            event.preventDefault(); // Prevent page scroll
            
            if (isPlaying) {
              pauseGame();
            } else {
              startGame();
            }
          }
        }
      });
      
      // Mobile navigation functions
      setupMobileNavigation();
    });
    
    // ============================================
    // MOBILE NAVIGATION
    // ============================================
    function scrollToPanel(index) {
      const container = document.querySelector('.main-container');
      const panels = container.querySelectorAll('.panel');
      
      if (panels[index]) {
        panels[index].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
        updateMobileNavActive(index);
      }
    }
    
    function updateMobileNavActive(index) {
      const buttons = document.querySelectorAll('.mobile-nav-btn');
      buttons.forEach((btn, i) => {
        if (i === index) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }
    
    function setupMobileNavigation() {
      const container = document.querySelector('.main-container');
      if (!container) return;
      
      // Update active button on scroll (for swipe detection)
      let scrollTimeout;
      container.addEventListener('scroll', () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          const containerWidth = container.offsetWidth;
          const scrollLeft = container.scrollLeft;
          const currentIndex = Math.round(scrollLeft / containerWidth);
          updateMobileNavActive(currentIndex);
        }, 100);
      });
    }
  </script>
</body>
</html>
